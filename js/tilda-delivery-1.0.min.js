window.t_delivery__browserLang=(window.navigator.userLanguage||window.navigator.language).toUpperCase().slice(0,2),t_onReady((function(){var allrecords=document.getElementById("allrecords");if(allrecords)var projectLang=allrecords.getAttribute("data-tilda-project-lang");projectLang&&(window.t_delivery__browserLang=projectLang)})),window.t_delivery__isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);var tcart_newDelivery={deliveryState:{currentRequest:null,projectId:null,city:{},services:{},searchboxes:{},focusoutTimers:{},cityCoordinates:null,ymapApiKey:null,cityGuid:null,streetGuid:null,currencyCode:null,pickupList:null,postalCode:null,staticCities:null,geoData:null,autocompleteData:{cities:null},badResponseCounters:{services:0},activeServiceUid:null,freeDeliveryThreshold:null,fullNames:{city:"",street:"",house:"",pickup:""}},init:function(ymapApiKey){var that=this;window.tcart_newDeliveryActive=!0,that.updateProjectId();var cart=document.querySelector(".t706");cart&&(that.deliveryState.currencyCode=cart.getAttribute("data-project-currency-code")),that.deliveryState.ymapApiKey=ymapApiKey,that.deliveryState.ymapApiKey&&that.mapAppendScript("",ymapApiKey);var deliveryWrapper=cart.querySelector(".t-radio__wrapper-delivery"),allDeliveryWrapper=cart.querySelectorAll(".t-radio__wrapper-delivery");allDeliveryWrapper.length>0&&Array.prototype.forEach.call(allDeliveryWrapper,(function(el){el.innerHTML=""})),deliveryWrapper.setAttribute("id","customdelivery");var deliveryTitle=that.createTitle(t_delivery__dict("delivery"));deliveryWrapper.appendChild(deliveryTitle),tcart__blockSubmitButton();var onDoneCityFromGeo=function(data){if(data){var cityInput=that.createInput("",t_delivery__dict("city"),null,null,null,null,"searchbox-input load js-tilda-rule","tildadelivery-city",null,null,!0,null,"chosevalue"),searchbox=that.createSearchbox(cityInput,"city-searchbox"),postalCodeInput=that.createInput("","",null,null,null,null,"","tildadelivery-postalcode",!0),hashInput=that.createInput("","hash",null,null,null,null,"","tildadelivery-hash",!0),countryInput=that.createInput("","country",null,null,null,null,"","tildadelivery-country",!0);deliveryWrapper.appendChild(postalCodeInput),deliveryWrapper.appendChild(hashInput),deliveryWrapper.appendChild(countryInput),deliveryWrapper.appendChild(searchbox),that.searchboxInit("city-searchbox","city");var deliveryServicesWrapper=document.createElement("div"),cityData;if(deliveryServicesWrapper.id="delivery-services-wrapper",deliveryWrapper.appendChild(deliveryServicesWrapper),that.deliveryState.geoData=data,data.cities?(cityData=data.cities[0],that.deliveryState.staticCities=data.cities):cityData=data,cityData&&(that.deliveryState.city=cityData,that.deliveryState.cityGuid=cityData.guid,that.deliveryState.countryIso=cityData.countryIso,that.deliveryState.postalCode=cityData.postalCode,that.deliveryState.cityPostalCode=cityData.postalCode),""===cityData.name){var citySearchInput=document.querySelector(".t706 #city-searchbox input");return citySearchInput.classList.remove("load"),void(citySearchInput.readOnly=!1)}cityData.fullName&&(document.querySelector(".t706 #city-searchbox .t-input-description").textContent=cityData.fullName),cityData.countryIso&&(document.querySelector('[name="tildadelivery-country"]').value=cityData.countryIso),that.deliveryState.ymapApiKey&&cityData.name&&that.getCityCoordinates("yandex",cityData.name,(function(data){var coordinates;try{(coordinates=data.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos.split(" "))&&(coordinates=[coordinates[1],coordinates[0]],that.deliveryState.cityCoordinates=coordinates)}catch(e){console.error(e)}})),that.deliveryState.searchboxes["city-searchbox"]||(that.deliveryState.searchboxes["city-searchbox"]={}),that.deliveryState.searchboxes["city-searchbox"].address=cityData,that.deliveryState.fullNames.city=cityData.fullName,cityData.name&&(document.querySelector('input[name="tildadelivery-city"]').value=cityData.name),document.querySelector('input[name="tildadelivery-city"]').setAttribute("data-option-selected",!0),that.setPostalCodeInput(cityData.postalCode),that.renderServices(cityData.postalCode),tcart__updateDelivery()}};that.getCityFromGeo(that.deliveryState.projectId,onDoneCityFromGeo,(function(error){that.changeEndpoint(error,(function(){that.getCityFromGeo(that.deliveryState.projectId,onDoneCityFromGeo,(function(){that.showUnavailableMessage(deliveryWrapper)}))}),(function(){that.showUnavailableMessage(deliveryWrapper)}))}));var customDelivery=document.getElementById("customdelivery");if(customDelivery){var events="click",clearTarget="";window.t_delivery__isMobile?(events+=" touchstart",clearTarget=".searchbox-input"):(events+=" mousedown",clearTarget+=".t-input-clear"),events.split(" ").forEach((function(e){customDelivery.addEventListener(e,(function(e){for(var target=e.target;target&&target!=this;target=target.parentNode){if(target.matches(".searchbox-change-pickup")){var searchBoxWrapper=target.closest(".searchbox-wrapper");searchBoxWrapper&&searchBoxWrapper.classList.remove("show-info")}if(target.matches(clearTarget)){clickHandler.call(target,e);break}}}),!1)}))}function clickHandler(event){var target=event.target,doClear=!1;if(target.matches(".searchbox-input")&&window.t_delivery__isMobile){var style=getComputedStyle(target),width=target.offsetWidth+parseInt(style.marginLeft)+parseInt(style.marginRight),inputWrapper=target.closest(".t-input-block");width-event.offsetX<=45&&inputWrapper&&inputWrapper.classList.contains("active")&&(doClear=!0)}else target.matches(".t-input-clear")&&(doClear=!0);if(doClear){var searchbox=target.closest(".searchbox-wrapper"),searchboxId=searchbox.getAttribute("id");searchbox.querySelector(".searchbox-list").innerHTML="",clearTimeout(that.deliveryState.focusoutTimers[searchboxId]),searchbox.querySelector(".searchbox-input").value="",searchbox.querySelector(".t-input-block").classList.remove("active"),setTimeout((function(){searchbox.querySelector(".searchbox-input").focus()}),50),that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].address&&(that.deliveryState.searchboxes[searchboxId].address=null)}}that.renderFullAddressNode()},disableChoseServiceControls:function(){var inputs=document.querySelectorAll('.t706 input[name="tildadelivery-type"]');Array.prototype.forEach.call(inputs,(function(el){el.setAttribute("disabled","disabled")}))},enableChoseServiceControls:function(){var inputs=document.querySelectorAll('.t706 input[name="tildadelivery-type"]');Array.prototype.forEach.call(inputs,(function(el){el.removeAttribute("disabled")}))},getFullAddress:function(){var fullNames=this.deliveryState.fullNames,address="";return fullNames.pickup?address+=fullNames.city+", "+fullNames.pickup:fullNames.street?address+=fullNames.city+", "+fullNames.street:null===fullNames.pickup&&null===fullNames.street&&fullNames.house&&(address+=fullNames.city+","),fullNames.house&&(address+=" "+fullNames.house),""===address&&(address=fullNames.city),address},renderFullAddressNode:function(){var addressNode=document.createElement("div"),ref;addressNode.classList.add("delivery-full-address"),addressNode.classList.add("t-descr"),document.querySelector(".t706__cartwin-totalamount-info").insertAdjacentElement("afterend",addressNode)},setFullAddress:function(address){var addressNode=document.querySelector(".delivery-full-address");addressNode&&(addressNode.textContent=address)},changeCartInputsHandler:function(){var that=this,inputs=document.querySelectorAll(".t706 input");Array.prototype.forEach.call(inputs,(function(el){el.removeEventListener("change",that.saveTcartDelivery),el.addEventListener("change",that.saveTcartDelivery)}))},saveTcartDelivery:function(){var keysForTcartDelivery=["city","street","pickup-name","pickup-address","pickup-id","house","entrance","floor","aptoffice","phone","entrancecode","comment","service-id","hash","postalcode","country","userinitials","onelineaddress"],cart=document.querySelector(".t706"),keysForAutoComplete;keysForTcartDelivery.forEach((function(key){var value="",el=cart.querySelector('[name="tildadelivery-'+key+'"]');switch(el&&(value=el.value),key){case"service-id":(el=cart.querySelector('[name="tildadelivery-type"]:checked'))&&(value=el.getAttribute("data-service-id"));break;case"pickup-id":(el=cart.querySelector("[data-pickup-id]"))&&(value=el.getAttribute("data-pickup-id"));break;case"pickup-address":(el=cart.querySelector("[data-pickup-address]"))&&(value=el.getAttribute("data-pickup-address"))}""!==value&&void 0!==window.tcart.delivery&&(window.tcart.delivery[key]=value)})),void 0===window.t_delivery__userFieldsAutoComplete&&(window.t_delivery__userFieldsAutoComplete={}),["street","house","entrance","floor","aptoffice","phone","entrancecode","comment","postalcode","country","userinitials","onelineaddress"].forEach((function(key){var value="",el=cart.querySelector('[name="tildadelivery-'+key+'"]');el&&(value=el.value),""!==value&&void 0!==window.tcart.delivery&&(window.t_delivery__userFieldsAutoComplete[key]=value)}))},restoreTcartDelivery:function(){var keys=["street","house","entrance","floor","aptoffice","phone","entrancecode","comment","postalcode","country","userinitials","onelineaddress"],cart=document.querySelector(".t706"),userFields=window.t_delivery__userFieldsAutoComplete;keys.forEach((function(key){var inputName="tildadelivery-"+key,el=cart.querySelector("[name="+inputName+"]");el&&void 0!==userFields&&void 0!==userFields[key]&&""!==userFields[key]&&(el.value=userFields[key],"street"===key&&tcart__inputErrorHandler.show(el,t_delivery__dict("selectAddress")))}))},mapAppendScript:function(type,ymapApiKey){var script=document.createElement("script");script.src="https://api-maps.yandex.ru/2.1/?apikey="+(ymapApiKey||"")+"&lang=ru_RU",document.head.appendChild(script)},mapInit:function(type){if("yandex"===type&&void 0!==window.ymaps){var mapWrapper=document.createElement("div");mapWrapper.id="delivery-yandex-map",document.getElementById("pickup-searchbox").querySelector(".searchbox-inner-wrapper").appendChild(mapWrapper);var that=this;window.ymaps.ready((function(){window.t_delivery__map=new ymaps.Map("delivery-yandex-map",{center:that.deliveryState.cityCoordinates||[55.76,37.64],zoom:8,controls:["zoomControl"],maxZoom:20},{yandexMapDisablePoiInteractivity:!0});var eventsPane,eventsPaneEl=window.t_delivery__map.panes.get("events").getElement(),mobilePanelText={EN:"Use two fingers to move the map",RU:"Чтобы переместить карту проведите по ней двумя пальцами",FR:"Utilisez deux doigts pour déplacer la carte",DE:"Verschieben der Karte mit zwei Fingern",ES:"Para mover el mapa, utiliza dos dedos",PT:"Use dois dedos para mover o mapa",UK:"Переміщуйте карту двома пальцями",JA:"地図を移動させるには指 2 本で操作します",ZH:"使用双指移动地图",PL:"Przesuń mapę dwoma palcami",KK:"Картаны екі саусақпен жылжытыңыз",IT:"Utilizza due dita per spostare la mappa",LV:"Lai pārvietotu karti, bīdiet to ar diviem pirkstiem"},mobilePanelStyles={alignItems:"center",boxSizing:"border-box",color:"white",display:"flex",justifyContent:"center",fontSize:"22px",fontFamily:"Arial,sans-serif",opacity:"0.0",padding:"25px",textAlign:"center",transition:"opacity .3s",touchAction:"auto"};Object.keys(mobilePanelStyles).forEach((function(name){eventsPaneEl.style[name]=mobilePanelStyles[name]})),window.tStoreIsMobile&&(window.t_delivery__map.behaviors.disable("drag"),window.ymaps.domEvent.manager.add(eventsPaneEl,"touchmove",(function(event){1===event.get("touches").length&&(eventsPaneEl.style.transition="opacity .3s",eventsPaneEl.style.background="rgba(0, 0, 0, .45)",eventsPaneEl.textContent=mobilePanelText[window.t_delivery__browserLang]||mobilePanelText.EN,eventsPaneEl.style.opacity="1")})),window.ymaps.domEvent.manager.add(eventsPaneEl,"touchend",(function(){eventsPaneEl.style.transition="opacity .8s",eventsPaneEl.style.opacity="0"})))}))}},mapAddPoints:function(type,points,searchbox){var that=this;void 0!==window.ymaps&&window.ymaps.ready((function(){window.t_delivery__map.geoObjects&&window.t_delivery__map.geoObjects.removeAll();var pointsForCluster=[];if(points.forEach((function(point){0===point.coordinates[0]&&0===point.coordinates[1]||pointsForCluster.push(point.coordinates)})),pointsForCluster.length>0){for(var clusterer=new ymaps.Clusterer({preset:"islands#circleIcon",groupByCoordinates:!1,clusterDisableClickZoom:!1,clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1}),getPointData=function(index){var point=points[index],name=point.name,address=point.address||"",worktime=point.workTime||"",phones=point.phones||"",addressComment=point.addressComment||"",phonesLabel="",balloonContentHeader="";balloonContentHeader+="<b>"+name+"</b>";var balloonContentBody="";balloonContentBody+="<b>"+t_delivery__dict("address")+": </b>"+address+"</br>";var restrictions="";return point.cash&&"n"===point.cash&&(restrictions+="cash"),balloonContentBody+='<div style="margin: 10px 0;" class="delivery-map-point-select" '+(restrictions?'data-restrictions="'+restrictions+'"':"")+" data-point-index="+index+' onclick="window.tcart__chosePointOnMap(this); return false;">'+t_delivery__dict("select")+"</div>",balloonContentBody+=addressComment?addressComment+"</br>":"",balloonContentBody+=worktime?"<b>"+t_delivery__dict("workingHours")+": </b>"+worktime+"</br>":"",phones.length&&(balloonContentBody+=(phonesLabel=phones.length>1?"<b>"+t_delivery__dict("phones")+": </b>":"<b>"+t_delivery__dict("phone")+": </b>")+phones.join(", ")+"</br>"),window.tcart__chosePointOnMap=function(button){var i=button.dataset.pointIndex,point=points[i],searchInput=searchbox.querySelector(".searchbox-input"),searchboxId=searchbox.getAttribute("id");tcart__inputErrorHandler.hide(searchInput),searchInput.setAttribute("data-option-selected",!0),that.deliveryState.fullNames.pickup=point.address;var postalCode=point.postalCode;""===postalCode&&(postalCode=that.deliveryState.cityPostalCode),that.deliveryState.postalCode=postalCode,that.deliveryState.pickupPointId=point.id,that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),that.deliveryState.searchboxes[searchboxId].address={name:point.name,pickupid:point.id,postalCode:postalCode},that.setPostalCodeInput(postalCode),that.changePickupHandler(point.id,point.name,postalCode,searchbox,point.address),document.querySelector('.t706 [name="tildadelivery-pickup-name"]').value=point.name,that.saveTcartDelivery(),window.t_delivery__map.balloon.close(),that.showPickupInfo(point.id,searchbox),that.hidePaymentMethod(button)},{balloonContentHeader:balloonContentHeader,balloonContentBody:balloonContentBody,balloonContentFooter:""}},getPointOptions=function(index){return{preset:"islands#circleIcon",index:index}},geoObjects=[],i=0,len=pointsForCluster.length;i<len;i++)geoObjects[i]=new ymaps.Placemark(pointsForCluster[i],getPointData(i),getPointOptions(i));clusterer.options.set({gridSize:80,clusterDisableClickZoom:!1}),clusterer.add(geoObjects),window.t_delivery__map.geoObjects.add(clusterer),window.t_delivery__map.setBounds(clusterer.getBounds(),{checkZoomRange:!0}).then((function(){window.t_delivery__map.getZoom()>20&&window.t_delivery__map.setZoom(18)}),this)}}))},setPostalCodeInput:function(value){var cart;document.querySelector(".t706").querySelector('input[name="tildadelivery-postalcode"]').value=value},setHashInput:function(value){var cart;document.querySelector(".t706").querySelector('input[name="tildadelivery-hash"]').value=value},createSearchbox:function(input,id){var searchboxWrapper=document.createElement("div");searchboxWrapper.classList.add("searchbox-wrapper"),searchboxWrapper.setAttribute("id",id);var searchboxInnerWrapper=document.createElement("div");searchboxInnerWrapper.classList.add("searchbox-inner-wrapper"),searchboxInnerWrapper.appendChild(input);var searchboxList=document.createElement("div");searchboxList.classList.add("searchbox-list"),searchboxList.setAttribute("tabindex",-1),searchboxInnerWrapper.appendChild(searchboxList),searchboxWrapper.appendChild(searchboxInnerWrapper);var searchboxInfo=document.createElement("div");return searchboxInfo.classList.add("searchbox-info"),searchboxInfo.setAttribute("tabindex",-1),searchboxWrapper.appendChild(searchboxInfo),searchboxWrapper},searchboxInit:function(searchboxId,searchboxType){var searchbox=document.getElementById(searchboxId),searchInput=searchbox.querySelector(".searchbox-input"),inputWrapper=searchInput.closest(".t-input-block"),that=this,changeTimeout;"paste keyup".split(" ").forEach((function(eventName){searchInput.addEventListener(eventName,(function(event){event.keyCode>=33&&event.keyCode<=40||(clearTimeout(changeTimeout),that.deliveryState.searchboxes[searchboxId]&&(that.deliveryState.searchboxes[searchboxId].address=null),that.deliveryState.searchboxes[searchboxId]&&"pickup"!==searchboxType&&(that.deliveryState.searchboxes[searchboxId].autocompleteAddress=null),""===searchInput.value||inputWrapper.classList.contains("active")||inputWrapper.classList.add("active"),changeTimeout=setTimeout((function(){that.changeSearchboxInputHandler(event,searchbox,searchboxType),changeTimeout=null}),500))}),!1)}));var clicked=!1,timeout;"click mousedown keyup".split(" ").forEach((function(eventName){searchInput.addEventListener(eventName,(function(event){clicked||(clicked=!0,clearTimeout(timeout),timeout=setTimeout((function(){that.clickSearchboxInputHandler(event,searchbox,searchboxType)}),150)),setTimeout((function(){clicked=!1}),200)}),!1)})),searchInput.addEventListener("blur",(function(event){var relatedTarget=event.relatedTarget;relatedTarget&&relatedTarget.classList.contains("searchbox-list")||(clearTimeout(changeTimeout),that.focusoutSearchboxInputHandler(searchbox,searchboxType))}),!1)},clickSearchboxInputHandler:function(event,searchbox,searchboxType){var searchInput=searchbox.querySelector(".searchbox-input"),inputWrapper=searchInput.closest(".t-input-block");""===searchInput.value||inputWrapper.classList.contains("active")||inputWrapper.classList.add("active");var searchList=searchbox.querySelector(".searchbox-list"),searchListItems;if(searchbox.querySelectorAll(".searchbox-list-item").length)searchList.style.display="";else if(!searchInput.classList.contains("load")){var isAddressStrong,serviceId=parseInt(searchInput.getAttribute("data-service-id"),10);serviceId&&(isAddressStrong=this.deliveryState.services[serviceId].strongAddress);var that=this,searchboxId=searchbox.getAttribute("id");this.deliveryState.searchboxes[searchboxId]&&"pickup"!==searchboxType&&(this.deliveryState.searchboxes[searchboxId].autocompleteAddress=null);var pattern=(event.target.value||"").trim(),ajaxData,data;switch(searchbox.classList.contains("load")||(searchbox.classList.add("load"),searchbox.readOnly=!0),searchboxType){case"city":if(""===pattern)return searchList.innerHTML='<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery__dict("noResult")+"</div>",searchList.style.display="",searchbox.classList.remove("load"),void(searchbox.readOnly=!1);if(ajaxData={pattern:pattern},ajaxData=JSON.stringify(ajaxData),that.deliveryState.searchboxes[searchboxId]&&(that.deliveryState.searchboxes[searchboxId].autocompleteAddress||that.deliveryState.staticCities)){if(searchbox.classList.remove("load"),searchbox.readOnly=!1,(data=that.deliveryState.staticCities||that.deliveryState.searchboxes[searchboxId].autocompleteAddress).error||0===data.length)return void(""!==searchInput.value?searchList.innerHTML='<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery__dict("noResult")+"</div>":searchList.innerHTML="");searchList.style.display="",that.deliveryState.searchboxes[searchboxId].autocompleteAddress=data[0],that.deliveryState.searchboxes[searchboxId].addresses=data,that.deliveryState.autocompleteData.cities=data,that.fillSearchList(searchList,data,"address"),that.choseSearchListItemHandler(searchbox,searchboxType)}else{var onDoneAddressesCity=function(data){searchbox.classList.remove("load"),searchbox.readOnly=!1,data.error||0===data.length?""!==searchInput.value?searchList.innerHTML='<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery__dict("noResult")+"</div>":searchList.innerHTML="":(searchList.style.display="",that.deliveryState.searchboxes[searchboxId].autocompleteAddress=data[0],that.deliveryState.searchboxes[searchboxId].addresses=data,that.deliveryState.autocompleteData.cities=data,that.fillSearchList(searchList,data,"address"),that.choseSearchListItemHandler(searchbox,searchboxType))};that.getAddresses(ajaxData,searchboxType,onDoneAddressesCity,(function(error){that.changeEndpoint(error,(function(){that.getAddresses(ajaxData,searchboxType,onDoneAddressesCity)}))}))}break;case"pickup":var deliveryServiceId=searchInput.getAttribute("data-service-id"),restrictions="",radioDeliveryService=document.querySelector('.t706 input.t-radio_delivery[data-service-id="'+deliveryServiceId+'"]');if(radioDeliveryService&&(restrictions=radioDeliveryService.dataset.restrictions||""),that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].autocompleteAddress){if(searchbox.classList.remove("load"),searchbox.readOnly=!1,(data=that.deliveryState.searchboxes[searchboxId].autocompleteAddress).error||0===data.length){searchList.innerHTML="";var lang=window.t_delivery__browserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";return void tcart__errorHandler.show(userFriendlyError||data.error)}data=(data=data.filter((function(item){return-1!==item.name.toLowerCase().indexOf(pattern.toLowerCase())||-1!==item.address.toLowerCase().indexOf(pattern.toLowerCase())}))).map((function(item){return"cash"===restrictions&&(item.cash="n"),item})),that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),that.fillSearchList(searchList,data,"pickup"),that.choseSearchListItemHandler(searchbox,searchboxType)}else{var onDonePickupList=function(data){if(searchbox.classList.remove("load"),searchbox.readOnly=!1,data.error||0===data.length){""!==searchInput.value?searchList.innerHTML='<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery__dict("noResult")+"</div>":searchList.innerHTML="";var lang=window.t_delivery__browserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";tcart__errorHandler.show(userFriendlyError||data.error)}else that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),that.deliveryState.searchboxes[searchboxId].autocompleteAddress=data,that.deliveryState.pickupList=data,that.fillSearchList(searchList,data,"pickup"),that.choseSearchListItemHandler(searchbox,searchboxType)};that.getPickupList({projectId:that.deliveryState.projectId,postalCode:that.deliveryState.city.postalCode,deliveryId:deliveryServiceId,pattern:pattern,onDone:onDonePickupList,onFail:function(error){that.changeEndpoint(error,(function(){that.getPickupList({projectId:that.deliveryState.projectId,postalCode:that.deliveryState.city.postalCode,deliveryId:deliveryServiceId,pattern:pattern,onDone:onDonePickupList})}))}})}break;case"street":ajaxData={pattern:pattern,fias:this.deliveryState.cityGuid},ajaxData=JSON.stringify(ajaxData),that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),isAddressStrong&&"street"===searchboxType&&searchInput.setAttribute("data-option-selected",!1);var onDoneAddressesStreet=function(data){searchbox.classList.remove("load"),searchbox.readOnly=!1,data.error||0===data.length?""!==searchInput.value?searchList.innerHTML='<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery__dict("noResult")+"</div>":searchList.innerHTML="":(that.deliveryState.searchboxes[searchboxId].autocompleteAddress=data[0],that.fillSearchList(searchList,data,"address"),that.choseSearchListItemHandler(searchbox,searchboxType))};that.getAddresses(ajaxData,searchboxType,onDoneAddressesStreet,(function(error){that.changeEndpoint(error,(function(){that.getAddresses(ajaxData,searchboxType,onDoneAddressesStreet)}))}));break;case"house":ajaxData={pattern:pattern,fias:this.deliveryState.streetGuid||this.deliveryState.cityGuid},ajaxData=JSON.stringify(ajaxData);var onDoneAddressesHouse=function(data){searchbox.classList.remove("load"),searchbox.readOnly=!1,data.error||0===data.length?searchList.innerHTML="":(that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),that.deliveryState.searchboxes[searchboxId].autocompleteAddress=data[0],that.fillSearchList(searchList,data,"address"),that.choseSearchListItemHandler(searchbox,searchboxType))};that.getAddresses(ajaxData,searchboxType,onDoneAddressesHouse,(function(error){that.changeEndpoint(error,(function(){that.getAddresses(ajaxData,searchboxType,onDoneAddressesHouse)}))}));break;default:searchbox.classList.remove("load"),searchbox.readOnly=!1}}},changeSearchboxInputHandler:function(e,searchbox,searchboxType){var that=this,searchList=searchbox.querySelector(".searchbox-list"),searchInput=searchbox.querySelector(".searchbox-input"),inputWrapper=searchInput.closest(".t-input-block"),searchboxId=searchbox.getAttribute("id"),serviceId=parseInt(searchInput.getAttribute("data-service-id")),isAddressStrong;if(serviceId&&(isAddressStrong=this.deliveryState.services[serviceId].strongAddress),!searchInput.classList.contains("load")){var pattern=(e.target.value||"").trim(),ajaxData,data;switch(searchbox.classList.contains("load")||(searchbox.classList.add("load"),searchbox.readOnly=!0),""===searchInput.value&&inputWrapper.classList.remove("active"),searchboxType){case"city":if(ajaxData={pattern:pattern},ajaxData=JSON.stringify(ajaxData),that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.staticCities){if(searchbox.classList.remove("load"),searchbox.readOnly=!1,data=that.deliveryState.staticCities,Array.isArray(data)?data=data.filter((function(item){return-1!==item.name.toLowerCase().indexOf(pattern.toLowerCase())||-1!==item.fullName.toLowerCase().indexOf(pattern.toLowerCase())})):console.log(data),0===data.length)return void(""!==searchInput.value?searchList.innerHTML='<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery__dict("noResult")+"</div>":searchList.innerHTML="");that.deliveryState.searchboxes[searchboxId].autocompleteAddress=data[0],that.deliveryState.searchboxes[searchboxId].addresses=data,that.deliveryState.autocompleteData.cities=data,that.fillSearchList(searchList,data,"address"),that.choseSearchListItemHandler(searchbox,searchboxType)}else{var onDoneAddressesCity=function(data){searchbox.classList.remove("load"),searchbox.readOnly=!1,data.error||0===data.length?""!==searchInput.value?searchList.innerHTML='<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery__dict("noResult")+"</div>":searchList.innerHTML="":(that.deliveryState.searchboxes[searchboxId].autocompleteAddress=data[0],that.deliveryState.searchboxes[searchboxId].addresses=data,that.deliveryState.autocompleteData.cities=data,that.fillSearchList(searchList,data,"address"),that.choseSearchListItemHandler(searchbox,searchboxType))};that.getAddresses(ajaxData,searchboxType,onDoneAddressesCity,(function(error){that.changeEndpoint(error,(function(){that.getAddresses(ajaxData,searchboxType,onDoneAddressesCity)}))}))}break;case"pickup":if(searchInput.setAttribute("data-option-selected",!1),that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].autocompleteAddress){if(searchbox.classList.remove("load"),searchbox.readOnly=!1,0===(data=(data=that.deliveryState.searchboxes[searchboxId].autocompleteAddress).filter((function(item){return-1!==item.name.toLowerCase().indexOf(pattern.toLowerCase())||-1!==item.address.toLowerCase().indexOf(pattern.toLowerCase())}))).length)return void(""!==searchInput.value?searchList.innerHTML='<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery__dict("noResult")+"</div>":searchList.innerHTML="");that.fillSearchList(searchList,data,"pickup"),that.choseSearchListItemHandler(searchbox,searchboxType)}break;case"street":ajaxData={pattern:pattern,fias:this.deliveryState.cityGuid},ajaxData=JSON.stringify(ajaxData),that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),isAddressStrong&&searchInput.setAttribute("data-option-selected",!1);var onDoneAddressesStreet=function(data){searchbox.classList.remove("load"),searchbox.readOnly=!1,data.error||0===data.length?""!==searchInput.value?searchList.innerHTML='<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery__dict("noResult")+"</div>":searchList.innerHTML="":(that.deliveryState.searchboxes[searchboxId].autocompleteAddress=data[0],that.deliveryState.searchboxes[searchboxId].addresses=data,that.fillSearchList(searchList,data,"address"),that.choseSearchListItemHandler(searchbox,searchboxType))};that.getAddresses(ajaxData,searchboxType,onDoneAddressesStreet,(function(error){that.changeEndpoint(error,(function(){that.getAddresses(ajaxData,searchboxType,onDoneAddressesStreet)}))}));break;case"house":ajaxData={pattern:pattern,fias:this.deliveryState.streetGuid||this.deliveryState.cityGuid},ajaxData=JSON.stringify(ajaxData),that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={});var onDoneAddressesHouse=function(data){searchbox.classList.remove("load"),searchbox.readOnly=!1,data.error||0===data.length?""!==searchInput.value?searchList.innerHTML='<div class="searchbox-list-item t-text" style="user-select: none; pointer-events: none;">'+t_delivery__dict("noResult")+"</div>":searchList.innerHTML="":(that.deliveryState.searchboxes[searchboxId].autocompleteAddress=data[0],that.deliveryState.searchboxes[searchboxId].addresses=data,that.fillSearchList(searchList,data,"address"),that.choseSearchListItemHandler(searchbox,searchboxType))};that.getAddresses(ajaxData,searchboxType,onDoneAddressesHouse,(function(error){that.changeEndpoint(error,(function(){that.getAddresses(ajaxData,searchboxType,onDoneAddressesHouse)}))}))}}},choseSearchListItemHandler:function(searchbox,searchboxType){var searchboxId=searchbox.getAttribute("id"),searchInput=searchbox.querySelector(".searchbox-input"),searchboxDescriptionInput=searchbox.querySelector(".t-input-description"),searchList=searchbox.querySelector(".searchbox-list"),searchListItems=searchbox.querySelectorAll(".searchbox-list-item"),postalCode,that=this,serviceId,inputWrapper=searchInput.closest(".t-input-block");tcart__inputErrorHandler.hide(searchInput);var clicked=!1;"click mousedown".split(" ").forEach((function(eventName){Array.prototype.forEach.call(searchListItems,(function(searchListItem){searchListItem.addEventListener(eventName,(function(e){if(!clicked){switch(clicked=!0,tcart__blockSubmitButton(),inputWrapper.classList.remove("active"),clearTimeout(that.deliveryState.focusoutTimers[searchboxId]),postalCode=e.target.dataset.postalcode,that.deliveryState.postalCode=postalCode,that.setPostalCodeInput(postalCode),that.deliveryState.searchboxes[searchboxId]||(that.deliveryState.searchboxes[searchboxId]={}),searchboxType){case"city":var cityGeoData;searchInput.classList.add("load"),searchInput.readOnly=!0,tcart__errorHandler.hide(),searchInput.value=e.target.dataset.name,searchboxDescriptionInput.innerHTML=e.target.dataset.fullName,document.querySelector('.t706 [name="tildadelivery-country"]').value=e.target.dataset.countryIso,searchInput.setAttribute("data-guid",e.target.dataset.guid),that.deliveryState.ymapApiKey&&e.target.dataset.name&&that.getCityCoordinates("yandex",e.target.dataset.name,(function(data){var coordinates;try{(coordinates=data.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos.split(" "))&&(coordinates=[coordinates[1],coordinates[0]],that.deliveryState.cityCoordinates=coordinates)}catch(e){console.error(e)}})),that.deliveryState.searchboxes[searchboxId].address={name:e.target.dataset.name,postalCode:postalCode,guid:e.target.dataset.guid},that.deliveryState.city={name:e.target.dataset.name,fullName:e.target.dataset.fullName,postalCode:postalCode,guid:e.target.dataset.guid,hasStreets:e.target.dataset.hasStreets},e.target.dataset.hasHousesWithoutStreets&&(that.deliveryState.city.hasHousesWithoutStreets=!0),that.deliveryState.cityPostalCode=postalCode;for(var length=that.deliveryState.autocompleteData.cities.length,i=0;i<length;i++)if(that.deliveryState.autocompleteData.cities[i].guid===e.target.dataset.guid){cityGeoData=that.deliveryState.autocompleteData.cities[i];break}that.deliveryState.geoData=cityGeoData,that.deliveryState.cityGuid=e.target.dataset.guid,that.deliveryState.streetGuid=null,that.deliveryState.fullNames={},that.deliveryState.fullNames.city=e.target.dataset.fullName,document.getElementById("delivery-services-wrapper").innerHTML="",that.renderServices(postalCode),searchList.style.display="none";break;case"street":serviceId=parseInt(searchInput.getAttribute("data-service-id"),10),searchInput.value=e.target.dataset.shortname,searchInput.setAttribute("data-guid",e.target.dataset.guid),postalCode=postalCode||that.deliveryState.city.postalCode,that.deliveryState.searchboxes[searchboxId].address={name:e.target.dataset.name,shortName:e.target.dataset.shortname,postalCode:postalCode,guid:e.target.dataset.guid},that.deliveryState.streetGuid=e.target.dataset.guid,that.deliveryState.fullNames.street=e.target.dataset.shortname,that.deliveryState.fullNames.house=null,that.clearHouseInput(),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery();var onDoneDeliveryPriceStreet=function(data){if(data.error||0===data.length){var lang=window.t_delivery__browserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";return tcart__errorHandler.show(userFriendlyError||data.error),window.tcart.emptyDeliveryServices=!0,void tcart__updateDelivery()}if(window.tcart.emptyDeliveryServices=!1,tcart__errorHandler.hide(),void 0!==data.hash&&that.setHashInput(data.hash),void 0!==data.price){var servicePrice=data.price;that.updatePriceValueInRadio(servicePrice,serviceId)}that.setFullAddress(that.getFullAddress()),tcart__showDeliveryPrice()};that.getDeliveryPrice({projectId:that.deliveryState.projectId,postalCode:postalCode,serviceId:serviceId,onDone:onDoneDeliveryPriceStreet,onFail:function(error){that.changeEndpoint(error,(function(){that.getDeliveryPrice({projectId:that.deliveryState.projectId,postalCode:postalCode,serviceId:serviceId,onDone:onDoneDeliveryPriceStreet,onFail:function(){var error="";error="RU"===window.t_delivery__browserLang?'Невозможно получить почтовый индекс для доставки. Пожалуйста, перезагрузите страницу и попробуйте еще раз. Если ситуация не изменилась, обратитесь в поддержку <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for street" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.':'Unable to get a postal code for delivery. Please <a href="javascript:window.location.reload();" style="color:#fff;text-decoration:underline;">reload the page</a> and try again. If the situation has not changed, please contact support <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for street" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.',tcart__errorHandler.show("Request failed: "+error),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery()}})}))}}),searchList.innerHTML="";break;case"pickup":var coordinates=e.target.dataset.coordinates.split(",");that.hidePaymentMethod(e.target),that.changePickupHandler(e.target.dataset.pickupid,e.target.dataset.name,postalCode,searchbox,e.target.dataset.address,coordinates),that.deliveryState.searchboxes[searchboxId].address={name:e.target.dataset.name,pickupid:e.target.dataset.pickupid,postalCode:postalCode},that.deliveryState.fullNames[searchboxType]=e.target.dataset.address,that.deliveryState.pickupPointId=e.target.dataset.pickupid,that.showPickupInfo(e.target.dataset.pickupid,searchbox),searchList.innerHTML="";break;case"house":serviceId=parseInt(searchInput.getAttribute("data-service-id"),10),searchInput.value=e.target.dataset.name,postalCode=postalCode||that.deliveryState.city.postalCode,that.deliveryState.searchboxes[searchboxId].address={postalCode:postalCode},that.deliveryState.fullNames[searchboxType]=e.target.dataset.name,window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery();var onDoneDeliveryPriceHouse=function(data){if(data.error||0===data.length){var lang=window.t_delivery__browserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";return tcart__errorHandler.show(userFriendlyError||data.error),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery(),void that.removePriceValueInRadio(serviceId)}if(window.tcart.emptyDeliveryServices=!1,tcart__errorHandler.hide(),void 0!==data.hash&&that.setHashInput(data.hash),void 0!==data.price){var servicePrice=data.price;that.updatePriceValueInRadio(servicePrice,serviceId)}that.setFullAddress(that.getFullAddress()),tcart__showDeliveryPrice()};that.getDeliveryPrice({projectId:that.deliveryState.projectId,postalCode:postalCode,serviceId:serviceId,onDone:onDoneDeliveryPriceHouse,onFail:function(error){that.changeEndpoint(error,(function(){that.getDeliveryPrice({projectId:that.deliveryState.projectId,postalCode:postalCode,serviceId:serviceId,onDone:onDoneDeliveryPriceHouse,onFail:function(){var error="";error="RU"===window.t_delivery__browserLang?'Невозможно получить почтовый индекс для доставки. Пожалуйста, перезагрузите страницу и попробуйте еще раз. Если ситуация не изменилась, обратитесь в поддержку <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for house" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.':'Unable to get a postal code for delivery. Please <a href="javascript:window.location.reload();" style="color:#fff;text-decoration:underline;">reload the page</a> and try again. If the situation has not changed, please contact support <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for house" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.',tcart__errorHandler.show("Request failed: "+error),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery()}})}))}}),searchList.innerHTML=""}searchInput.setAttribute("data-option-selected",!0),setTimeout((function(){clicked=!1}),200)}}),!1)}))}))},focusoutSearchboxInputHandler:function(searchbox,searchboxType){var that=this,postalCode,searchList=searchbox.querySelector(".searchbox-list"),searchboxDescriptionInput=searchbox.querySelector(".t-input-description"),searchboxId=searchbox.getAttribute("id"),searchInput=searchbox.querySelector(".searchbox-input"),inputWrapper=searchInput.closest(".t-input-block"),data,serviceId=parseInt(searchInput.getAttribute("data-service-id"),10),isAddressStrong;serviceId&&""!==searchList.innerHTML?(isAddressStrong=this.deliveryState.services[serviceId].strongAddress,this.deliveryState.city.hasHousesWithoutStreets&&(isAddressStrong=!1),searchInput.setAttribute("data-option-selected",!1)):searchInput.setAttribute("data-option-selected",!0),this.deliveryState.focusoutTimers[searchboxId]=setTimeout((function(){if(inputWrapper.classList.remove("active"),that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].address)return tcart__inputErrorHandler.hide(searchInput),void("city"===searchboxType?searchList.style.display="none":searchList.innerHTML="");switch(searchboxType){case"city":if(that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].autocompleteAddress&&searchInput.value===that.deliveryState.searchboxes[searchboxId].autocompleteAddress.name){var cityGeoData;searchInput.classList.add("load"),searchInput.readOnly=!0,data=that.deliveryState.searchboxes[searchboxId].autocompleteAddress,that.deliveryState.searchboxes[searchboxId].address=data,tcart__inputErrorHandler.hide(searchInput),that.deliveryState.ymapApiKey&&data.name&&that.getCityCoordinates("yandex",data.name,(function(data){var coordinates;try{(coordinates=data.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos.split(" "))&&(coordinates=[coordinates[1],coordinates[0]],that.deliveryState.cityCoordinates=coordinates)}catch(e){console.error(e)}})),postalCode=data.postalCode,that.deliveryState.postalCode=postalCode,that.setPostalCodeInput(postalCode),document.querySelector('[name="tildadelivery-country"]').value=data.countryIso,searchInput.value=data.name,searchboxDescriptionInput.innerHTML=data.fullName,searchInput.setAttribute("data-guid",data.guid),that.deliveryState.city.name=data.name,that.deliveryState.city.fullName=data.fullName,that.deliveryState.city.postalCode=postalCode,that.deliveryState.city.guid=data.guid,that.deliveryState.cityPostalCode=postalCode,that.deliveryState.cityGuid=data.guid,that.deliveryState.streetGuid=null,that.deliveryState.fullNames={},that.deliveryState.fullNames[searchboxType]=data.fullName;for(var length=that.deliveryState.autocompleteData.cities.length,i=0;i<length;i++)if(that.deliveryState.autocompleteData.cities[i].guid===data.guid){cityGeoData=that.deliveryState.autocompleteData.cities[i];break}that.deliveryState.geoData=cityGeoData,searchList.style.display="none",that.renderServices(postalCode),searchInput.setAttribute("data-option-selected",!0)}else{searchList.innerHTML="";var addressesWrapper=document.getElementById("addresses-wrapper");addressesWrapper&&addressesWrapper.parentNode&&addressesWrapper.parentNode.removeChild(addressesWrapper),searchInput.setAttribute("data-option-selected",!1),that.deliveryState.streetGuid=null,tcart__inputErrorHandler.show(searchInput,t_delivery__dict("selectCity"))}document.getElementById("delivery-services-wrapper").innerHTML="";break;case"street":if(that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].autocompleteAddress&&searchInput.value===that.deliveryState.searchboxes[searchboxId].autocompleteAddress.shortName){data=that.deliveryState.searchboxes[searchboxId].autocompleteAddress,that.deliveryState.searchboxes[searchboxId].address=data,that.deliveryState.fullNames[searchboxType]=data.shortName,tcart__inputErrorHandler.hide(searchInput),postalCode=data.postalCode,that.deliveryState.postalCode=postalCode,searchInput.value=data.shortName,searchInput.setAttribute("data-guid",data.guid),that.deliveryState.streetGuid=data.guid,that.setPostalCodeInput(postalCode),searchInput.setAttribute("data-option-selected",!0),searchList.innerHTML="";var onDoneDeliveryPriceStreet=function(data){if(data.error||0===data.length){var lang=window.t_delivery__browserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";tcart__errorHandler.show(userFriendlyError||data.error)}else{if(void 0!==data.hash&&that.setHashInput(data.hash),void 0!==data.price){var servicePrice=data.price;that.updatePriceValueInRadio(servicePrice,serviceId)}that.setFullAddress(that.getFullAddress()),tcart__showDeliveryPrice()}};that.getDeliveryPrice({projectId:that.deliveryState.projectId,postalCode:postalCode,serviceId:serviceId,onDone:onDoneDeliveryPriceStreet,onFail:function(error){that.changeEndpoint(error,(function(){that.getDeliveryPrice({projectId:that.deliveryState.projectId,postalCode:postalCode,serviceId:serviceId,onDone:onDoneDeliveryPriceStreet,onFail:function(){var error="";error="RU"===window.t_delivery__browserLang?'Невозможно получить почтовый индекс для доставки. Пожалуйста, перезагрузите страницу и попробуйте еще раз. Если ситуация не изменилась, обратитесь в поддержку <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for street" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.':'Unable to get a postal code for delivery. Please <a href="javascript:window.location.reload();" style="color:#fff;text-decoration:underline;">reload the page</a> and try again. If the situation has not changed, please contact support <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for street" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.',tcart__errorHandler.show("Request failed: "+error),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery()}})}))}})}else isAddressStrong&&(searchInput.setAttribute("data-option-selected",!1),searchList.innerHTML="",tcart__inputErrorHandler.show(searchInput,t_delivery__dict("selectAddress"))),that.deliveryState.city.hasHousesWithoutStreets&&(searchInput.removeAttribute("data-guid"),that.deliveryState.streetGuid=null,that.deliveryState.fullNames.street=null,window.t_delivery__userFieldsAutoComplete&&(window.t_delivery__userFieldsAutoComplete.street=""),tcart__unblockSubmitButton()),searchList.innerHTML="";that.deliveryState.fullNames.house=null,that.clearHouseInput();break;case"house":if(that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].autocompleteAddress&&searchInput.value===that.deliveryState.searchboxes[searchboxId].autocompleteAddress.name){data=that.deliveryState.searchboxes[searchboxId].autocompleteAddress,that.deliveryState.searchboxes[searchboxId].address=data,that.deliveryState.fullNames[searchboxType]=data.name,tcart__inputErrorHandler.hide(searchInput),postalCode=data.postalCode,that.deliveryState.postalCode=postalCode,searchInput.val(data.name),searchInput.setAttribute("data-option-selected",!0),that.setPostalCodeInput(postalCode),searchList.innerHTML="";var onDoneDeliveryPriceHouse=function(data){if(data.error||0===data.length){var lang=window.t_delivery__browserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";tcart__errorHandler.show(userFriendlyError||data.error)}else{if(void 0!==data.hash&&that.setHashInput(data.hash),void 0!==data.price){var servicePrice=data.price;that.updatePriceValueInRadio(servicePrice,serviceId)}that.setFullAddress(that.getFullAddress()),tcart__showDeliveryPrice()}};that.getDeliveryPrice({projectId:that.deliveryState.projectId,postalCode:postalCode,serviceId:serviceId,onDone:onDoneDeliveryPriceHouse,onFail:function(error){that.changeEndpoint(error,(function(){that.getDeliveryPrice({projectId:that.deliveryState.projectId,postalCode:postalCode,serviceId:serviceId,onDone:onDoneDeliveryPriceHouse,onFail:function(){var error="";error="RU"===window.t_delivery__browserLang?'Невозможно получить почтовый индекс для доставки. Пожалуйста, перезагрузите страницу и попробуйте еще раз. Если ситуация не изменилась, обратитесь в поддержку <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for street" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.':'Unable to get a postal code for delivery. Please <a href="javascript:window.location.reload();" style="color:#fff;text-decoration:underline;">reload the page</a> and try again. If the situation has not changed, please contact support <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for street" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.',tcart__errorHandler.show("Request failed: "+error),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery()}})}))}})}else searchList.innerHTML="",that.deliveryState.city.hasHousesWithoutStreets&&tcart__inputErrorHandler.show(searchInput,t_delivery__dict("selectAddress"));break;case"pickup":searchList.innerHTML="";var autocompleteAddress=null,equalAddress=null;that.deliveryState.searchboxes[searchboxId]&&that.deliveryState.searchboxes[searchboxId].autocompleteAddress&&(autocompleteAddress=data=that.deliveryState.searchboxes[searchboxId].autocompleteAddress).forEach((function(address){address.name===searchInput.value&&(equalAddress=address)})),autocompleteAddress&&equalAddress?(data=equalAddress,that.deliveryState.searchboxes[searchboxId].address=data,that.deliveryState.fullNames[searchboxType]=data.address,tcart__inputErrorHandler.hide(searchInput),searchInput.setAttribute("data-option-selected",!0),that.changePickupHandler(data.id,data.name,data.postalCode,searchbox,data.address,data.coordinates),that.setPostalCodeInput(data.postalCode),that.deliveryState.pickupPointId=data.id,that.deliveryState.postalCode=data.postalCode,searchList.innerHTML=""):(searchInput.setAttribute("data-option-selected",!1),searchInput.removeAttribute("data-pickup-id"),searchInput.removeAttribute("data-pickup-address"),searchInput.removeAttribute("data-delivery-price"),delete that.deliveryState.pickupPointId,tcart__inputErrorHandler.show(searchInput,t_delivery__dict("selectAddress")))}}),200)},fillSearchList:function(searchList,data,type){var newWrap=document.createElement("div"),searchListItemDescription,titleText,descriptionText;data.forEach((function(address){var searchListItem=document.createElement("div");switch(searchListItem.classList.add("searchbox-list-item"),searchListItem.classList.add("t-text"),type){case"pickup":titleText=address.name,descriptionText=address.address;var restrictions="";address.cash&&"n"===address.cash&&(restrictions+="cash"),searchListItem.dataset.restrictions=restrictions;break;case"address":if(address.fullName){titleText=address.fullName.split(",").reverse()[0];var fullNameValue=address.fullName;(fullNameValue=fullNameValue.split(",").reverse()).shift(),fullNameValue=fullNameValue.join(", "),descriptionText=fullNameValue}else titleText=address.name,descriptionText=""}searchListItem.dataset.name=address.name,searchListItem.dataset.fullName=address.fullName||"",searchListItem.dataset.postalcode=address.postalCode,searchListItem.dataset.guid=address.guid||"",searchListItem.dataset.pickupid=address.id||"",searchListItem.dataset.shortname=address.shortName||"",searchListItem.dataset.address=address.address||"",searchListItem.dataset.hasStreets=address.hasStreets,address.hasHousesWithoutStreets&&(searchListItem.dataset.hasHousesWithoutStreets=!0),searchListItem.dataset.coordinates=address.coordinates||"",searchListItem.dataset.countryIso=address.countryIso||"";var searchListItemText=document.createElement("div");searchListItemText.classList.add("searchbox-list-item-text"),searchListItemText.appendChild(document.createTextNode(titleText)),searchListItem.appendChild(searchListItemText),(searchListItemDescription=document.createElement("div")).classList.add("searchbox-list-item-description"),searchListItemDescription.appendChild(document.createTextNode(descriptionText)),searchListItem.appendChild(searchListItemDescription),newWrap.appendChild(searchListItem)})),searchList.innerHTML="",searchList.appendChild(newWrap),searchList.scrollTop=0},showPickupInfo:function(pickupId,searchbox){var searchboxInfo=searchbox.querySelector(".searchbox-info"),pickupData;searchbox.classList.add("show-info"),this.deliveryState.pickupList.forEach((function(pickupItem){pickupItem.id!=pickupId||(pickupData=pickupItem)}));var name=pickupData.name,address=pickupData.address||"",worktime=pickupData.workTime||"",phones=pickupData.phones||"",addressComment=pickupData.addressComment||"",infoContent="";infoContent+='<p style="font-weight: 400; margin-bottom: 15px;" class="t-text">'+t_delivery__dict("pickup")+":</p>",infoContent+='<p class="t-text">'+name+"</p>",infoContent+='<p class="t-text">'+t_delivery__dict("address")+": "+address+"</p>",addressComment&&(infoContent+='<p class="t-text" style="opacity: 0.6; line-height: 22px; font-size: .9rem;">'+addressComment+"</p>"),infoContent+=worktime?'<p class="t-text">'+t_delivery__dict("workingHours")+": "+worktime+"</p>":"",phones.length&&(infoContent+=phones.length>1?'<p class="t-text">'+t_delivery__dict("phones")+": "+phones.join(", ")+"</p>":'<p class="t-text">'+t_delivery__dict("phone")+": "+phones.join(", ")+"</p>"),infoContent+='<span style="border-bottom: 1px dashed #000; font-weight: 400; margin-top: 10px; display: inline-block; cursor: pointer;" class="t-text searchbox-change-pickup">'+t_delivery__dict("change")+"</span>",searchboxInfo.innerHTML=infoContent},renderServices:function(postalCode,callbackFunctionAfterRender){this.deliveryState.services={},this.deliveryState.postalCode={};var deliveryServicesWrapper=document.getElementById("delivery-services-wrapper");deliveryServicesWrapper&&(deliveryServicesWrapper.innerHTML="");var addressesWrapper=document.getElementById("addresses-wrapper");addressesWrapper&&addressesWrapper.parentNode&&addressesWrapper.parentNode.removeChild(addressesWrapper);var cityPostalCode=this.deliveryState.cityPostalCode||"",that=this,currencyCode=this.deliveryState.currencyCode,citySearchInput=document.querySelector(".t706 #city-searchbox input"),cart=document.querySelector(".t706"),cartContents=cart.querySelectorAll(".t706 .t706__cartwin-products, .t706 .t706__orderform"),deliveryWrapper=cart.querySelector(".t-radio__wrapper-delivery"),onDoneServices=function(data){if(data.error){var lang=window.t_delivery__browserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";return window.tcart.emptyDeliveryServices=!0,tcart__errorHandler.show(userFriendlyError||data.error),citySearchInput.classList.remove("load"),citySearchInput.readOnly=!1,void tcart__updateDelivery()}0===data.length?(window.tcart.emptyDeliveryServices=!0,that.deliveryState.activeServiceUid=null,tcart__errorHandler.show(t_delivery__dict("deliveryNotPossible")),citySearchInput.classList.remove("load"),citySearchInput.readOnly=!1):window.tcart.emptyDeliveryServices=!1;var radioControls=document.querySelectorAll(".t706 #delivery-services-wrapper .t-radio__control");if(Array.prototype.forEach.call(radioControls,(function(radio){radio&&radio.parentNode&&radio.parentNode.removeChild(radio)})),Array.isArray(data)){var serviceUidsFromServer=[];data.forEach((function(service){serviceUidsFromServer.push(parseInt(service.id,10))}));var deliveryState,activeServiceUid=that.deliveryState.activeServiceUid;-1===serviceUidsFromServer.indexOf(activeServiceUid)&&(that.deliveryState.activeServiceUid=null),data.forEach((function(service,index){if(service.currency&&service.currency!==that.deliveryState.currencyCode)return console.error(service.title+": wrong delivery currency ("+service.currency+")"),void(data.length===index+1&&(Array.prototype.forEach.call(cartContents,(function(el){el.style.pointerEvents=""})),citySearchInput.classList.remove("load"),citySearchInput.readOnly=!1));that.deliveryState.services[service.id]={},that.deliveryState.services[service.id].fields=service.fields,that.deliveryState.services[service.id].strongAddress=service.strongAddress;var restrictions="";"n"===service.cash&&(restrictions+="cash");var checkedStatus=!1;0===index&&(checkedStatus=!0);var serviceItem=that.createRadio({title:service.title,minimumTime:service.minimumDeliverTime,minimumPrice:service.minimumPrice,staticPrice:service.staticPrice,deliveryType:service.type,serviceId:service.id,hint:service.hint,hash:service.hash,restrictions:restrictions,checkedStatus:checkedStatus,freeDeliveryThreshold:service.freeDeliveryThreshold});document.getElementById("delivery-services-wrapper").appendChild(serviceItem)}))}tcart__updateDelivery(),that.changeDeliveryTypeListener();var el=document.getElementById("delivery-services-wrapper").querySelector('input[name="tildadelivery-type"]:checked');el&&t_cart__triggerEvent(el,"change"),Array.prototype.forEach.call(cartContents,(function(el){el.style.pointerEvents=""})),tcart__showDeliveryPrice(),"function"==typeof callbackFunctionAfterRender&&callbackFunctionAfterRender(),t_delivery__triggerEvent(deliveryServicesWrapper,"renderDeliveryServices")};that.getServices(that.deliveryState.projectId,cityPostalCode,currencyCode,onDoneServices,(function(error){if(0===that.deliveryState.badResponseCounters.services)return that.deliveryState.badResponseCounters.services++,void setTimeout((function(){that.renderServices(postalCode)}),2500);that.deliveryState.badResponseCounters.services>0&&that.changeEndpoint(error,(function(){that.getServices(that.deliveryState.projectId,cityPostalCode,currencyCode,onDoneServices,(function(){tcart__preloader.hide(),that.showUnavailableMessage(deliveryWrapper)}))}),(function(){tcart__preloader.hide(),that.showUnavailableMessage(deliveryWrapper)}))}))},getCityFromGeo:function(projectId,onDone,onFail){var dataObj={projectId:projectId};if(!window.dev){var tCityFromGeo=sessionStorage.getItem("tCityFromGeo");if(null!==tCityFromGeo)try{return void onDone(JSON.parse(tCityFromGeo))}catch(e){}}var tildaProjectLang=document.getElementById("allrecords").getAttribute("data-tilda-project-lang");tildaProjectLang&&(dataObj.lang=tildaProjectLang),dataObj=JSON.stringify(dataObj);var xhr=new XMLHttpRequest;xhr.onload=function(){xhr.readyState===xhr.DONE&&200===xhr.status&&(window.dev||sessionStorage.setItem("tCityFromGeo",xhr.responseText),onDone(JSON.parse(xhr.responseText)))},"function"==typeof onFail&&(xhr.ontimeout=xhr.onerror=function(error){xhr.isTimeout="timeout"===error.type,onFail(xhr)});var that=this;this.endpointDelivery||(this.endpointDelivery=".tildacdn.com"),xhr.open("POST","https://geoserv"+this.endpointDelivery+"/api/detect-city/"),xhr.timeout=3e4,xhr.send(dataObj)},getPayTypes:function(){var customDelivery=document.getElementById("customdelivery"),paytypes;if(customDelivery&&(paytypes=customDelivery.getAttribute("data-paytypes")),customDelivery){if(paytypes)try{paytypes=JSON.parse(paytypes)}catch(error){}if(!paytypes||"object"!=typeof paytypes&&"function"!=typeof paytypes){paytypes={};var paymentsystem=document.querySelectorAll(".t706 input[name=paymentsystem]");if(Array.prototype.forEach.call(paymentsystem,(function(el){"cash"===el.value?paytypes.cash="y":"banktransfer"===el.value?paytypes.banktransfer="y":paytypes.card="y"})),!paytypes.card&&!paytypes.cash&&!paytypes.banktransfer){var paytype=document.querySelector(".t706").getAttribute("data-payment-system");"cash"==paytype?paytypes.cash="y":"banktransfer"==paytype?paytypes.banktransfer="y":paytype&&""!=paytype&&"none"!=paytype?paytypes.card="y":paytypes.none="y"}customDelivery.setAttribute("data-paytypes",JSON.stringify(paytypes))}return paytypes}},getServices:function(projectId,postalCode,currencyCode,onDone,onFail){tcart__blockSubmitButton(),this.updateTotal();var itemsCount=window.tcart.total||0;if(void 0===itemsCount||itemsCount<1)onDone({error:new Error("RU"===window.t_delivery__browserLang?"добавьте в корзину хотя бы один товар":"add at least one product")});else{var cartAmount=window.tcart.prodamount||0;(window.tcart.prodamount_withdiscount||0===window.tcart.prodamount_withdiscount)&&(cartAmount=window.tcart.prodamount_withdiscount);var products=this.removeEmptyOrDeletedProducts(),servicesWrapper=document.getElementById("delivery-services-wrapper");servicesWrapper&&(servicesWrapper.style.display="none",tcart__preloader.show(servicesWrapper,t_delivery__dict("loadingServices"))),tcart__hideDeliveryPrice();var dataObj={action:"list",projectId:projectId,postalCode:postalCode||0,currency:currencyCode,itemsCount:itemsCount,cartAmount:cartAmount,geoData:this.deliveryState.geoData||{},products:products,paytypes:this.getPayTypes()},tildaProjectLang=document.getElementById("allrecords").getAttribute("data-tilda-project-lang");tildaProjectLang&&(dataObj.lang=tildaProjectLang),dataObj=JSON.stringify(dataObj);var xhr=new XMLHttpRequest;xhr.onload=function(){tcart__preloader.hide(),servicesWrapper&&(servicesWrapper.style.display=""),xhr.readyState===xhr.DONE&&200===xhr.status&&onDone(JSON.parse(xhr.responseText))},"function"==typeof onFail&&(xhr.ontimeout=xhr.onerror=function(error){xhr.isTimeout="timeout"===error.type,onFail(xhr)});var that=this;this.endpointDelivery||(this.endpointDelivery=".tildacdn.com"),xhr.open("POST","https://delivery"+this.endpointDelivery+"/cart-api/"),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),xhr.timeout=3e4,xhr.send(dataObj)}},getPickupList:function(params){tcart__blockSubmitButton(),this.updateTotal();var itemsCount=window.tcart.total||0;if(void 0===itemsCount||itemsCount<1)params.onDone({error:new Error("RU"===window.t_delivery__browserLang?"добавьте в корзину хотя бы один товар":"add at least one product")});else{var cartAmount=window.tcart.prodamount||0;(window.tcart.prodamount_withdiscount||0===window.tcart.prodamount_withdiscount)&&(cartAmount=window.tcart.prodamount_withdiscount);var products=this.removeEmptyOrDeletedProducts(),dataObj={action:"pickup-list",projectId:params.projectId,postalCode:params.postalCode||0,deliveryId:params.deliveryId,pattern:params.pattern,itemsCount:itemsCount,cartAmount:cartAmount,geoData:this.deliveryState.geoData||{},products:products,paytypes:this.getPayTypes()},tildaProjectLang=document.getElementById("allrecords").getAttribute("data-tilda-project-lang");tildaProjectLang&&(dataObj.lang=tildaProjectLang),dataObj=JSON.stringify(dataObj);var xhr=new XMLHttpRequest;xhr.onload=function(){xhr.readyState===xhr.DONE&&200===xhr.status&&params.onDone(JSON.parse(xhr.responseText)),tcart__updateDelivery()},"function"==typeof params.onFail&&(xhr.ontimeout=xhr.onerror=function(error){xhr.isTimeout="timeout"===error.type,params.onFail(xhr)});var that=this;this.endpointDelivery||(this.endpointDelivery=".tildacdn.com"),xhr.open("POST","https://delivery"+this.endpointDelivery+"/cart-api/"),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),xhr.timeout=3e4,xhr.send(dataObj)}},getDeliveryPrice:function(params){tcart__hideDeliveryPrice(),tcart__blockSubmitButton(),this.updateTotal();var itemsCount=window.tcart.total||0;if(void 0===itemsCount||itemsCount<1)params.onDone({error:new Error("RU"===window.t_delivery__browserLang?"добавьте в корзину хотя бы один товар":"add at least one product")});else{var cartAmount=window.tcart.prodamount||0;(window.tcart.prodamount_withdiscount||0===window.tcart.prodamount_withdiscount)&&(cartAmount=window.tcart.prodamount_withdiscount);var products=this.removeEmptyOrDeletedProducts(),dataObj={action:"calculate",projectId:params.projectId,postalCode:params.postalCode,deliveryId:params.serviceId,currency:this.deliveryState.currencyCode,itemsCount:itemsCount,cartAmount:cartAmount,pickupPointId:params.pickupPointId,products:products,guid:this.deliveryState.cityGuid||0};dataObj=JSON.stringify(dataObj);var xhr=new XMLHttpRequest;xhr.onload=function(){xhr.readyState===xhr.DONE&&200===xhr.status&&params.onDone(JSON.parse(xhr.responseText)),tcart__updateDelivery()},"function"==typeof params.onFail&&(xhr.ontimeout=xhr.onerror=function(error){xhr.isTimeout="timeout"===error.type,params.onFail(xhr)});var that=this;this.endpointDelivery||(this.endpointDelivery=".tildacdn.com"),xhr.open("POST","https://delivery"+this.endpointDelivery+"/cart-api/"),xhr.timeout=3e4,xhr.send(dataObj)}},getCityCoordinates:function(mapType,city,onDone){var xhr=new XMLHttpRequest;xhr.onload=function(){xhr.readyState===xhr.DONE&&200===xhr.status&&onDone(JSON.parse(xhr.responseText))},xhr.open("GET","https://geocode-maps.yandex.ru/1.x/?apikey="+this.deliveryState.ymapApiKey+"&format=json&geocode="+city),xhr.timeout=3e4,xhr.send()},getAddresses:function(data,type,onDone,onFail){var that=this;that.deliveryState.currentRequest&&that.deliveryState.currentRequest.abort(),that.endpointDelivery||(that.endpointDelivery=".tildacdn.com");var apiURL={street:"https://geoserv"+that.endpointDelivery+"/api/address/",city:"https://geoserv"+that.endpointDelivery+"/api/city/",pickup:"https://delivery"+that.endpointDelivery+"/cart-api/",house:"https://geoserv"+that.endpointDelivery+"/api/house/"},pattern="";try{var json=JSON.parse(data);if(pattern="t"+type+"_"+json.pattern.toLowerCase(),void 0!==json.fias&&(pattern+="_"+json.fias),void 0===window.dev){var tDataFromGeo=sessionStorage.getItem(pattern);if(null!==tDataFromGeo)try{return void onDone(JSON.parse(tDataFromGeo))}catch(e){}}var tildaProjectLang=document.getElementById("allrecords").getAttribute("data-tilda-project-lang");tildaProjectLang&&(json.lang=tildaProjectLang,data=JSON.stringify(json))}catch(e){}var xhr=new XMLHttpRequest;xhr.onload=function(){xhr.readyState===xhr.DONE&&200===xhr.status&&(window.dev||sessionStorage.setItem(pattern,xhr.responseText),onDone(JSON.parse(xhr.responseText))),tcart__updateDelivery(),that.deliveryState.currentRequest=null},"function"==typeof onFail&&(xhr.ontimeout=xhr.onerror=function(error){xhr.isTimeout="timeout"===error.type,onFail(xhr),that.deliveryState.currentRequest=null}),apiURL[type]&&xhr.open("POST",apiURL[type]),xhr.timeout=3e4,xhr.send(data),that.deliveryState.currentRequest=xhr},createInput:function(inputType,label,placeholder,defaultValue,inputId,serviceId,classes,name,hidden,groupStyle,isRequired,inputMode,tildaRule){label=label||"",placeholder=placeholder||"",inputId=inputId||"",serviceId=serviceId||"",inputType=inputType||"",inputMode=inputMode||"",defaultValue=defaultValue||"",tildaRule=tildaRule||"",isRequired=isRequired?1:0,classes=classes+" t-input"||"t-input";var div=document.createElement("div");div.classList.add("t-input-group"),div.classList.add("t-input-group_in"),groupStyle&&(div.style.cssText=groupStyle),hidden&&div.setAttribute("hidden",""),div.setAttribute("data-input-lid","");var title=document.createElement("div");title.classList.add("t-input-title"),title.classList.add("t-descr"),title.classList.add("t-descr_md"),title.setAttribute("data-redactor-toolbar","no"),title.setAttribute("field",""),title.appendChild(document.createTextNode(label)),div.appendChild(title);var inputWrapper=document.createElement("div");inputWrapper.classList.add("t-input-block");var input=document.createElement("input");if(classes.split(" ").forEach((function(className){""!==className&&input.classList.add(className)})),tildaRule&&input.setAttribute("data-tilda-rule",tildaRule),inputMode&&input.setAttribute("inputmode",inputMode),inputType&&input.setAttribute("type",inputType),input.setAttribute("data-service-id",serviceId),input.name=name.toLowerCase(),input.value=defaultValue,input.placeholder=placeholder,input.autocomplete=-1!==navigator.userAgent.search(/Chrome/)?"no":"off",input.setAttribute("data-tilda-req",isRequired),input.dataset.tildaReq=isRequired,inputWrapper.appendChild(input),"hidden"!==inputType){var svg=document.createElementNS("http://www.w3.org/2000/svg","svg");svg.setAttribute("viewBox","0 0 88 88"),svg.classList.add("t706__search-icon");var path=document.createElementNS("http://www.w3.org/2000/svg","path");path.setAttribute("d","M85 31.1c-.5-8.7-4.4-16.6-10.9-22.3C67.6 3 59.3 0 50.6.6c-8.7.5-16.7 4.4-22.5 11-11.2 12.7-10.7 31.7.6 43.9l-5.3 6.1-2.5-2.2-17.8 20 9 8.1 17.8-20.2-2.1-1.8 5.3-6.1c5.8 4.2 12.6 6.3 19.3 6.3 9 0 18-3.7 24.4-10.9 5.9-6.6 8.8-15 8.2-23.7zM72.4 50.8c-9.7 10.9-26.5 11.9-37.6 2.3-10.9-9.8-11.9-26.6-2.3-37.6 4.7-5.4 11.3-8.5 18.4-8.9h1.6c6.5 0 12.7 2.4 17.6 6.8 5.3 4.7 8.5 11.1 8.9 18.2.5 7-1.9 13.8-6.6 19.2z"),path.setAttribute("fill","#3f3f3f"),svg.appendChild(path),inputWrapper.appendChild(svg);var inputClear=document.createElement("div");inputClear.classList.add("t-input-clear"),inputWrapper.appendChild(inputClear)}var inputDescription=document.createElement("div");inputDescription.classList.add("t-input-description"),inputDescription.classList.add("t-text"),inputDescription.classList.add("t-text_xs"),inputDescription.style.cssText="color: #505050; margin: 5px 0 0;",inputWrapper.appendChild(inputDescription);var inputError=document.createElement("div");return inputError.classList.add("t-input-error"),inputWrapper.appendChild(inputError),div.appendChild(inputWrapper),div},createRadio:function(params){var title=params.title||"",minimumTime=params.minimumTime||"",minimumPrice=params.minimumPrice||"",staticPrice=params.staticPrice||"",deliveryType=params.deliveryType,serviceId=params.serviceId,hint=params.hint||"",hash=params.hash||"",restrictions=params.restrictions||"",checkedStatus=params.checkedStatus,freeDeliveryThreshold=params.freeDeliveryThreshold||"",classes=(params.classes||"")+" t-radio__control t-text t-text_xs",label=document.createElement("label");label.setAttribute("data-service-id",serviceId),classes.split(" ").forEach((function(className){""!==className&&label.classList.add(className)}));var input=document.createElement("input"),deliveryState,activeServiceUid=tcart_newDelivery.deliveryState.activeServiceUid,isActiveService=activeServiceUid===parseInt(params.serviceId,10);(checkedStatus&&!activeServiceUid||isActiveService)&&(input.checked=!0),input.setAttribute("data-delivery-price",""),restrictions&&(input.dataset.restrictions=restrictions),freeDeliveryThreshold&&input.setAttribute("data-free-delivery-threshold",freeDeliveryThreshold),hash&&input.setAttribute("data-hash-value",hash),staticPrice&&(input.setAttribute("data-delivery-price",staticPrice),input.setAttribute("data-static-price",staticPrice)),input.setAttribute("data-service-id",params.serviceId),input.setAttribute("data-delivery-type",deliveryType),input.setAttribute("type","radio"),input.setAttribute("name","tildadelivery-type"),input.classList.add("t-radio"),input.classList.add("t-radio_delivery"),input.classList.add("js-tilda-rule"),input.setAttribute("data-tilda-req",1),input.dataset.tildaReq=1,input.setAttribute("value",title),hint&&input.setAttribute("data-hint-text",hint),label.appendChild(input);var radioIndicator=document.createElement("div");radioIndicator.classList.add("t-radio__indicator"),radioIndicator.style.cssText="border-color: #000;",label.appendChild(radioIndicator);var spanValue=document.createElement("span");spanValue.classList.add("delivery-checkbox-label"),spanValue.appendChild(document.createTextNode(title)),label.appendChild(spanValue);var dayString=t_delivery__declensionOfNumber(minimumTime),spanPrice,spanPrice;minimumTime&&((spanPrice=document.createElement("span")).classList.add("delivery-minimum-time"),spanPrice.innerHTML=t_delivery__dict("from")+" "+minimumTime+" "+dayString,label.appendChild(spanPrice));if(staticPrice)(spanPrice=document.createElement("span")).classList.add("delivery-minimum-price"),spanPrice.innerHTML=t_delivery__showPrice(staticPrice),label.appendChild(spanPrice);else if(minimumPrice){var spanPrice;(spanPrice=document.createElement("span")).classList.add("delivery-minimum-price"),spanPrice.innerHTML=t_delivery__dict("from")+" "+t_delivery__showPrice(minimumPrice),label.appendChild(spanPrice)}return label},createTitle:function(label,classes){label=label||"",classes=classes||"";var div=document.createElement("div");return div.style.margin="20px 0",div.classList.add("t-name"),div.classList.add("t-name_md"),classes.split(" ").forEach((function(className){""!==className&&div.classList.add(className)})),div.appendChild(document.createTextNode(label)),div},createSelect:function(label,classes,options,pickupServiceId,name){label=label||"",classes=classes||"";var str="";return str+='<label class="t-input-title t-descr t-descr_md">Пункт выдачи</label>',str+='<div class="ss-select delivery-pickup-select">',str+='<select class="ss-input ss-select delivery-select" data-service-id="'+pickupServiceId+'" name="'+(name=name||"")+'">',str+='<option data-point-id="">Не выбран</option>',options.forEach((function(option){str+="<option data-point-id="+option.id+">"+option.address+"</option>"})),str+="</select>",str+="</div>"},changeDeliveryTypeListener:function(){var that=this,inputs=document.querySelectorAll(".t706 input[data-delivery-type]");Array.prototype.forEach.call(inputs,(function(el){el.addEventListener("change",(function(){var serviceUid=parseInt(this.getAttribute("data-service-id"),10)||0,freeDeliveryThreshold=parseInt(this.getAttribute("data-free-delivery-threshold"),10);that.deliveryState.freeDeliveryThreshold=freeDeliveryThreshold||0,that.deliveryState.activeServiceUid=serviceUid,tcart__errorHandler.hide(),that.renderAddressFields(this),this.dataset.hashValue&&that.setHashInput(this.dataset.hashValue),that.hidePaymentMethod(this);var inputsNeedUpdatePrice=document.querySelectorAll(".t706 input[data-delivery-type]");Array.prototype.forEach.call(inputsNeedUpdatePrice,(function(el){var price=el.getAttribute("data-static-price");price>0?el.setAttribute("data-delivery-price",price):el.setAttribute("data-delivery-price","")})),that.hints.deleteAll(),that.deliveryState.fullNames.pickup=null,that.deliveryState.fullNames.street=null,that.deliveryState.fullNames.house=null,that.deliveryState.searchboxes["pickup-searchbox"]&&(that.deliveryState.searchboxes["pickup-searchbox"]=null),this.getAttribute("data-hint-text")&&that.hints.render(this.getAttribute("data-hint-text")),tcart__updateDelivery()}),!1)}))},hidePaymentMethod:function(control){var cashControl=document.querySelector('.t706 [data-payment-variant-system="cash"]');if(cashControl){var cashControlParent=cashControl.parentNode,paymentWrapper,firstControl=cashControlParent.closest(".t-radio__wrapper-payment").querySelector('[data-payment-variant-system]:not([data-payment-variant-system="cash"])');"cash"===control.dataset.restrictions&&cashControl?(cashControlParent.style.display="none",firstControl.checked=!0,firstControl&&t_cart__triggerEvent(firstControl,"change")):cashControlParent.style.display=""}},removePriceValueInRadio:function(deliveryServiceId){var radioDeliveryService=document.querySelector('.t706 input.t-radio_delivery[data-service-id="'+deliveryServiceId+'"]');radioDeliveryService&&(radioDeliveryService.removeAttribute("data-delivery-price"),tcart__updateDelivery(),tcart__hideDeliveryPrice())},updatePriceValueInRadio:function(priceValue,deliveryServiceId){var serviceRadioInput=document.querySelector('.t706 input.t-radio_delivery[data-service-id="'+deliveryServiceId+'"]'),serviceMinimumPrice=document.querySelector('.t706 input.t-radio_delivery[data-service-id="'+deliveryServiceId+'"] ~ span.delivery-minimum-price');serviceRadioInput&&(serviceRadioInput.setAttribute("data-delivery-price",priceValue),tcart__updateDelivery(),tcart__showDeliveryPrice()),serviceMinimumPrice&&(serviceMinimumPrice.innerHTML=t_delivery__showPrice(priceValue))},changePickupHandler:function(pickupPointId,name,postalCode,searchbox,pickupAddress,coordinates){var searchInput=searchbox.querySelector(".searchbox-input"),serviceId=searchInput.getAttribute("data-service-id"),that=this;postalCode=postalCode||this.deliveryState.city.postalCode,searchInput.setAttribute("data-pickup-id",pickupPointId),searchInput.setAttribute("data-pickup-address",pickupAddress),searchInput.value=name;var onDoneDeliveryPrice=function(data){var servicePrice=data.price;if(data.error||0===data.length){var lang=window.t_delivery__browserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";return tcart__errorHandler.show(userFriendlyError||data.error),window.tcart.emptyDeliveryServices=!0,void tcart__updateDelivery()}window.tcart.emptyDeliveryServices=!1,tcart__errorHandler.hide(),void 0!==data.hash&&that.setHashInput(data.hash),pickupPointId||(servicePrice=0),that.updatePriceValueInRadio(servicePrice,serviceId),that.setFullAddress(that.getFullAddress())},isCoordinatesEmpty;that.getDeliveryPrice({projectId:that.deliveryState.projectId,postalCode:postalCode,serviceId:serviceId,pickupPointId:pickupPointId,onDone:onDoneDeliveryPrice,onFail:function(error){that.changeEndpoint(error,(function(){that.getDeliveryPrice({projectId:that.deliveryState.projectId,postalCode:postalCode,serviceId:serviceId,pickPointId:pickupPointId,onDone:onDoneDeliveryPrice,onFail:function(){var error="";error="RU"===window.t_delivery__browserLang?'Невозможно получить почтовый индекс для доставки. Пожалуйста, перезагрузите страницу и попробуйте еще раз. Если ситуация не изменилась, обратитесь в поддержку <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for street" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.':'Unable to get a postal code for delivery. Please <a href="javascript:window.location.reload();" style="color:#fff;text-decoration:underline;">reload the page</a> and try again. If the situation has not changed, please contact support <a href="mailto:team@tilda.cc?subject=Unable to get a postal code for street" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.',tcart__errorHandler.show("Request failed: "+error),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery()}})}))}}),coordinates&&(isCoordinatesEmpty=0==coordinates[0]&&0==coordinates[1]),coordinates&&window.t_delivery__map&&!isCoordinatesEmpty&&window.t_delivery__map.setCenter(coordinates,16)},renderAddressFields:function(element){this.disableChoseServiceControls(),tcart__blockSubmitButton();var that=this,wrapper=document.getElementById("customdelivery"),deliveryServiceId=element.getAttribute("data-service-id"),addressesWrapper=document.getElementById("addresses-wrapper");addressesWrapper&&addressesWrapper.parentNode&&addressesWrapper.parentNode.removeChild(addressesWrapper),wrapper.setAttribute("data-service-id",deliveryServiceId);var deliveryAddressesWrapper=document.createElement("div");deliveryAddressesWrapper.id="addresses-wrapper",wrapper.appendChild(deliveryAddressesWrapper);var deliveryType=element.getAttribute("data-delivery-type"),searchInput=document.querySelector(".t706 #city-searchbox input");switch(delete that.deliveryState.pickupPointId,deliveryType){case"pickup":tcart__preloader.show(document.getElementById("addresses-wrapper"),t_delivery__dict("loadingPickup")),window.tcart.emptyDeliveryServices=!1;var restrictions="",radioDeliveryService=document.querySelector('.t706 input.t-radio_delivery[data-service-id="'+deliveryServiceId+'"]');radioDeliveryService&&(restrictions=radioDeliveryService.dataset.restrictions||"");var onDonePickup=function(data){if(tcart__preloader.hide(),data.error){var lang=window.t_delivery__browserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";return tcart__errorHandler.show(userFriendlyError||data.error),window.tcart.emptyDeliveryServices=!0,that.enableChoseServiceControls(),searchInput.classList.remove("load"),searchInput.readOnly=!1,void tcart__updateDelivery()}data=data.map((function(item){return"cash"===restrictions&&(item.cash="n"),item}));var pickupInput=that.createInput("",t_delivery__dict("pickup"),t_delivery__dict("selectPickup"),null,null,deliveryServiceId,"searchbox-input js-tilda-rule","tildadelivery-pickup-name",null,null,!0,null,"chosevalue"),searchBox=that.createSearchbox(pickupInput,"pickup-searchbox");document.getElementById("addresses-wrapper").appendChild(searchBox),that.deliveryState.searchboxes["pickup-searchbox"]={},that.deliveryState.searchboxes["pickup-searchbox"].autocompleteAddress=data,that.deliveryState.pickupList=data,that.deliveryState.ymapApiKey&&that.mapInit("yandex"),that.searchboxInit("pickup-searchbox","pickup",null,data),that.renderUserFields(deliveryAddressesWrapper,deliveryServiceId),that.changeCartInputsHandler();var searchboxNode=document.querySelector(".t706 #pickup-searchbox");that.deliveryState.ymapApiKey&&that.mapAddPoints("",data,searchboxNode),that.enableChoseServiceControls(),searchInput.classList.remove("load"),searchInput.readOnly=!1};that.getPickupList({projectId:that.deliveryState.projectId,postalCode:that.deliveryState.city.postalCode,deliveryId:deliveryServiceId,onDone:onDonePickup,onFail:function(error){that.changeEndpoint(error,(function(){that.getPickupList({projectId:that.deliveryState.projectId,postalCode:that.deliveryState.city.postalCode,deliveryId:deliveryServiceId,onDone:onDonePickup})}))}});break;case"delivery":window.tcart.emptyDeliveryServices=!1,that.renderUserFields(deliveryAddressesWrapper,deliveryServiceId),that.changeCartInputsHandler(),that.enableChoseServiceControls(),searchInput.classList.remove("load"),searchInput.readOnly=!1}},clearHouseInput:function(){var house=document.querySelector('.t706 #customdelivery [name="tildadelivery-house"]');house&&(house.value="")},renderUserFields:function(wrapper,deliveryServiceId){var that=this,fields=this.deliveryState.services[deliveryServiceId].fields,smallSizeFieldsCount=0;for(var k in fields)switch(k){case"street":case"comment":case"userInitials":break;default:smallSizeFieldsCount++}var counter=0;for(var fieldKey in fields){var autocomplete=fields[fieldKey].autocomplete,inputLabel="",inputGroupStyle="",inputType="",inputMode="",inputPlaceholder="",inputRequired=!0;switch(fieldKey){case"street":inputLabel=t_delivery__dict("street"),inputGroupStyle="width: 100%",inputRequired="false"!=this.deliveryState.city.hasStreets,this.deliveryState.city.hasHousesWithoutStreets&&(inputRequired=!1);break;case"house":counter++,inputLabel=t_delivery__dict("house"),inputRequired="false"!=this.deliveryState.city.hasStreets,this.deliveryState.city.hasHousesWithoutStreets&&(inputRequired=!0);break;case"entrance":counter++,inputLabel=t_delivery__dict("entrance"),inputType="number",inputMode="numeric",inputRequired=!1;break;case"floor":counter++,inputLabel=t_delivery__dict("floor"),inputType="number",inputMode="numeric",inputRequired=!1;break;case"aptOffice":counter++,inputLabel=t_delivery__dict("apt"),inputRequired=!1;break;case"phone":counter++,inputLabel=t_delivery__dict("phone"),inputType="number",inputMode="numeric";break;case"entranceCode":counter++,inputLabel=t_delivery__dict("entranceCode"),inputRequired=!1;break;case"comment":inputLabel=t_delivery__dict("comment"),inputGroupStyle="width: 100%",inputRequired=!1,inputPlaceholder=t_delivery__dict("orderComment");break;case"oneLineAddress":counter++,inputLabel=t_delivery__dict("address");break;case"userInitials":inputGroupStyle="width: 100%",inputLabel=t_delivery__dict("fullName"),inputPlaceholder=t_delivery__dict("johnDoe")}smallSizeFieldsCount===counter&&smallSizeFieldsCount%2!=0&&(inputGroupStyle="width: 100%"),inputLabel=inputLabel||"";var inputName="tildadelivery-"+fieldKey,tildaRule="";if(autocomplete){inputRequired&&(tildaRule="chosevalue");var inputWithAutocomplete=this.createInput(inputType,inputLabel,inputPlaceholder,"","",deliveryServiceId,"searchbox-input js-tilda-rule",inputName,!1,inputGroupStyle,inputRequired,inputMode,tildaRule),searchboxId=fieldKey+"-searchbox",searchbox=this.createSearchbox(inputWithAutocomplete,searchboxId);wrapper.appendChild(searchbox),this.searchboxInit(searchboxId,fieldKey)}else{"userInitials"===fieldKey&&(tildaRule="name");var input=this.createInput(inputType,inputLabel,inputPlaceholder,"","",deliveryServiceId,"js-tilda-rule",inputName,!1,inputGroupStyle,inputRequired,inputMode,tildaRule);wrapper.appendChild(input)}}t_delivery__triggerEvent(wrapper,"renderDeliveryAddresses"),this.restoreTcartDelivery()},hints:{render:function(hintText){var deliveryServicesWrapper=document.getElementById("delivery-services-wrapper"),hintElem=document.createElement("div"),classes;"delivery-hint t-text t-text_xs".split(" ").forEach((function(className){hintElem.classList.add(className)})),hintElem.setAttribute("id","delivery-hint"),hintElem.appendChild(document.createTextNode(hintText)),deliveryServicesWrapper.insertAdjacentElement("afterend",hintElem)},deleteAll:function(){var deliveryHint=document.querySelector(".t706 .delivery-hint");deliveryHint&&deliveryHint.parentNode&&deliveryHint.parentNode.removeChild(deliveryHint)}},showUnavailableMessage:function(deliveryWrapper){var cityInput=this.createInput("hidden","","","nodelivery",null,null,"js-tilda-rule","delivery-badresponse-comment",null,null,!0,"","deliveryreq");window.tcart&&(window.tcart.system="none");var message=document.createElement("div");message.style.cssText="margin: 20px 0; line-height: 22px; color: red;",message.classList.add("t-text"),message.appendChild(document.createTextNode(t_delivery__dict("unavailable"))),deliveryWrapper.appendChild(message),deliveryWrapper.appendChild(cityInput)},updateTotal:function(){void 0!==window.tcart.products&&0!==window.tcart.products.length||void 0===window.tcart__syncProductsObject__LStoObj||void 0===window.tcart__updateTotalProductsinCartObj||(tcart__syncProductsObject__LStoObj(),tcart__updateTotalProductsinCartObj())},removeEmptyOrDeletedProducts:function(){var products=[];return window.tcart.products.forEach((function(product){"{}"!==JSON.stringify(product)&&"yes"!==product.deleted&&products.push(product)})),products},updateProjectId:function(){var that=this,itemsWithProjectId=[document.getElementById("allrecords"),document.getElementById("t-header"),document.getElementById("t-footer")];Array.prototype.forEach.call(itemsWithProjectId,(function(el){el&&!parseInt(that.deliveryState.projectId,10)&&(that.deliveryState.projectId=parseInt(el.getAttribute("data-tilda-project-id"),10))}));var el=document.getElementById("tildacopy");el&&!parseInt(that.deliveryState.projectId,10)&&(that.deliveryState.projectId=parseInt((el.getAttribute("data-tilda-sign")||"").split("#")[0],10))},endpointDelivery:".tildacdn.com",changeEndpoint:function(error,onChangeCallback,onErrorCallback){var that=this;"object"==typeof error&&(error.status>=500||408==error.status||410==error.status||429==error.status||error.isTimeout)&&".tildacdn.com"===this.endpointDelivery?(this.endpointDelivery="2.tildacdn.com","function"==typeof onChangeCallback&&onChangeCallback()):(error&&error.responseText?console.log("["+error.status+"] "+error.responseText+". Please, try again later."):error&&error.statusText?console.log("Error ["+error.status+", "+error.statusText+"]. Please, try again later."):error&&error.status?console.log("["+error.status+"] Unknown error. Please, try again later."):console.log("Unknown error. Please, try again later."),"function"==typeof onErrorCallback&&onErrorCallback())}},tcart__errorHandler={show:function(error){var errorBoxes=document.querySelectorAll(".t706 .js-errorbox-all"),errorBoxString=document.querySelectorAll(".t706 .t-form__errorbox-item.js-rule-error-string");error&&Array.prototype.forEach.call(errorBoxString,(function(stringEl){stringEl.innerHTML=error})),Array.prototype.forEach.call(errorBoxString,(function(stringEl){""!==stringEl.textContent&&(stringEl.style.display="block",Array.prototype.forEach.call(errorBoxes,(function(errorBoxEl){errorBoxEl&&(errorBoxEl.style.display="")})))}))},hide:function(){var errorBoxes=document.querySelectorAll(".t706 .js-errorbox-all"),errorBoxString=document.querySelectorAll(".t706 .t-form__errorbox-item.js-rule-error-string");Array.prototype.forEach.call(errorBoxes,(function(errorBoxEl){errorBoxEl&&(errorBoxEl.style.display="none")})),Array.prototype.forEach.call(errorBoxString,(function(stringEl){stringEl&&(stringEl.style.display="none")})),Array.prototype.forEach.call(errorBoxString,(function(stringEl){stringEl.innerHTML=""}))}},tcart__inputErrorHandler={show:function(input,errorText){var inputWrapper=input.closest(".t-input-group"),inputError;inputWrapper&&(inputWrapper.querySelector(".t-input-error").textContent=errorText,inputWrapper.classList.add("js-error-control-box"))},hide:function(input){var inputWrapper=input.closest(".t-input-group"),inputError;inputWrapper&&(inputWrapper.querySelector(".t-input-error").textContent="",inputWrapper.classList.remove("js-error-control-box"))}};function tcart__hideDeliveryPrice(){var totalamount=document.querySelector(".t706 .t706__cartwin-totalamount-info");totalamount&&(totalamount.style.opacity=0);var fullAddress=document.querySelector(".t706 .delivery-full-address");fullAddress&&(fullAddress.style.opacity=0)}function tcart__showDeliveryPrice(){var totalamount=document.querySelector(".t706 .t706__cartwin-totalamount-info");totalamount&&(totalamount.style.opacity=1);var fullAddress=document.querySelector(".t706 .delivery-full-address");fullAddress&&(fullAddress.style.opacity=1)}var tcart__preloader={show:function(elementForBefore,loadMessage){if(elementForBefore){var customdelivery=document.getElementById("customdelivery");if(customdelivery&&!customdelivery.querySelector(".tcart__preloader")){var loader=document.createElement("div");if(loader.classList.add("tcart__preloader"),loader.style.cssText="margin: 20px 0;",loadMessage){var text=document.createElement("div");text.classList.add("t-text"),loader.style.cssText="text-align: center; opacity: .5; font-size: 15px;",text.appendChild(document.createTextNode(loadMessage)),loader.appendChild(text)}var animatedLoader=document.createElement("div");animatedLoader.classList.add("lds-ellipsis"),animatedLoader.appendChild(document.createElement("div")),animatedLoader.appendChild(document.createElement("div")),animatedLoader.appendChild(document.createElement("div")),animatedLoader.appendChild(document.createElement("div")),loader.appendChild(animatedLoader),elementForBefore.insertAdjacentElement("beforebegin",loader)}}},hide:function(){var preloader=document.querySelector(".t706 .tcart__preloader");preloader&&preloader.parentNode&&preloader.parentNode.removeChild(preloader)}};function tcart__rerenderDeliveryServices(){clearTimeout(window.rerenderTimer),window.rerenderTimer=setTimeout((function(){var cartContents=document.querySelectorAll(".t706__cartwin-content .t706__product, .t706__cartwin-content .t-form__inputsbox");Array.prototype.forEach.call(cartContents,(function(el){el.style.pointerEvents="none"})),tcart__blockSubmitButton();var needRender=!1,that=tcart_newDelivery,deliveryState=that.deliveryState,deliveryServices=deliveryState.services,activeServiceUid=deliveryState.activeServiceUid,pickupPointId=deliveryState.pickupPointId;if(!activeServiceUid)return Array.prototype.forEach.call(cartContents,(function(el){el.style.pointerEvents=""})),void(0===Object.keys(that.deliveryState.services).length&&that.renderServices(deliveryState.postalCode));var serviceUidsFromCard=[],serviceUidsFromServer=[];if(Object.keys(deliveryServices).forEach((function(key){serviceUidsFromCard.push(parseInt(key,10))})),that.updateProjectId(),!parseInt(deliveryState.projectId,10)){var error="";return error="RU"===window.t_delivery__browserLang?'Невозможно получить сервисы доставок. Пожалуйста, перезагрузите страницу и попробуйте еще раз. Если ситуация не изменилась, обратитесь в поддержку <a href="mailto:team@tilda.cc?subject=Unable to get delivery services" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.':'Unable to get a delivery services. Please <a href="javascript:window.location.reload();" style="color:#fff;text-decoration:underline;">reload the page</a> and try again. If the situation has not changed, please contact support <a href="mailto:team@tilda.cc?subject=Unable to get delivery services" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.',tcart__errorHandler.show(error),window.tcart.emptyDeliveryServices=!0,void tcart__updateDelivery()}var onDoneServices=function(data){if(Array.isArray(data)&&(data.forEach((function(serviceFromServer){serviceUidsFromServer.push(parseInt(serviceFromServer.id,10))})),serviceUidsFromServer.sort((function(a,b){return a-b}))),serviceUidsFromCard.sort((function(a,b){return a-b})),needRender=JSON.stringify(serviceUidsFromServer)!==JSON.stringify(serviceUidsFromCard))-1!==serviceUidsFromServer.indexOf(activeServiceUid)?that.renderServices(deliveryState.postalCode,(function(){var activeServiceEl=document.querySelector('.t706 input[data-service-id="'+activeServiceUid+'"]');activeServiceEl.checked=!0,t_cart__triggerEvent(activeServiceEl,"change")})):that.renderServices(deliveryState.postalCode);else{var radioControls=document.querySelectorAll(".t706 #delivery-services-wrapper .t-radio__control"),postalCode;Array.prototype.forEach.call(radioControls,(function(radio){radio&&radio.parentNode&&radio.parentNode.removeChild(radio)})),Array.isArray(data)&&data.forEach((function(service){if(service.currency&&service.currency!==that.deliveryState.currencyCode)console.error(service.title+": wrong delivery currency ("+service.currency+")");else{that.deliveryState.services[service.id]={},that.deliveryState.services[service.id].fields=service.fields,that.deliveryState.services[service.id].strongAddress=service.strongAddress;var restrictions="";"n"===service.cash&&(restrictions+="cash");var checkedStatus=!1;parseInt(service.id,10)===activeServiceUid&&(checkedStatus=!0);var serviceItem=that.createRadio({title:service.title,minimumTime:service.minimumDeliverTime,minimumPrice:service.minimumPrice,staticPrice:service.staticPrice,deliveryType:service.type,serviceId:service.id,hint:service.hint,hash:service.hash,restrictions:restrictions,checkedStatus:checkedStatus,freeDeliveryThreshold:service.freeDeliveryThreshold});document.getElementById("delivery-services-wrapper").appendChild(serviceItem)}})),postalCode="object"==typeof deliveryState.postalCode?deliveryState.cityPostalCode:deliveryState.postalCode;var onDoneDeliveryPrice=function(data){if(data.error){window.tcart.emptyDeliveryServices=!0;var lang=window.t_delivery__browserLang.toLowerCase(),userFriendlyError=data.userFriendlyError?data.userFriendlyError[lang]?data.userFriendlyError[lang]:data.userFriendlyError.en:"";tcart__errorHandler.show(userFriendlyError||data.error)}else window.tcart.emptyDeliveryServices=!1,tcart__errorHandler.hide();if(void 0!==data.hash&&that.setHashInput(data.hash),void 0!==data.price){var servicePrice=data.price;that.updatePriceValueInRadio(servicePrice,activeServiceUid)}tcart__updateDelivery(),that.changeDeliveryTypeListener(),Array.prototype.forEach.call(cartContents,(function(el){el.style.pointerEvents=""})),tcart__showDeliveryPrice()};pickupPointId||that.deliveryState.fullNames.street?that.getDeliveryPrice({projectId:deliveryState.projectId,postalCode:postalCode,serviceId:activeServiceUid,pickupPointId:pickupPointId,onDone:onDoneDeliveryPrice,onFail:function(){that.changeEndpoint(error,(function(){that.getDeliveryPrice({projectId:deliveryState.projectId,postalCode:postalCode,serviceId:activeServiceUid,pickupPointId:pickupPointId,onDone:onDoneDeliveryPrice,onFail:function(){var error="";error="RU"===window.t_delivery__browserLang?'Невозможно получить почтовый индекс для доставки. Пожалуйста, перезагрузите страницу и попробуйте еще раз. Если ситуация не изменилась, обратитесь в поддержку <a href="mailto:team@tilda.cc?subject=Unable to get active service" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.':'Unable to get a postal code for delivery. Please <a href="javascript:window.location.reload();" style="color:#fff;text-decoration:underline;">reload the page</a> and try again. If the situation has not changed, please contact support <a href="mailto:team@tilda.cc?subject=Unable to get active service" style="color:#fff;text-decoration:underline;">team@tilda.cc</a>.',tcart__errorHandler.show("Request failed: "+error),window.tcart.emptyDeliveryServices=!0,tcart__updateDelivery()}})}))}}):(tcart__updateDelivery(),that.changeDeliveryTypeListener(),tcart__showDeliveryPrice())}Array.prototype.forEach.call(cartContents,(function(el){el.style.pointerEvents=""}))};that.getServices(deliveryState.projectId,deliveryState.cityPostalCode,deliveryState.currencyCode,onDoneServices,(function(error){that.changeEndpoint(error,(function(){that.getServices(deliveryState.projectId,deliveryState.cityPostalCode,deliveryState.currencyCode,onDoneServices)}))}))}),500)}function t_delivery__dict(msg){var dict=[];dict.address={EN:"Address",RU:"Адрес",FR:"Adresse",DE:"Adresse",ES:"Dirección",PT:"Endereço",JA:"住所",ZH:"地址",UK:"Адреса",PL:"Adres",KK:"Мекен-жай",IT:"Indirizzo",LV:"Adrese"},dict.city={EN:"City",RU:"Город",FR:"Ville",DE:"Stadt",ES:"Ciudad",PT:"Cidade",JA:"市",ZH:"城市",UK:"Місто",PL:"Miasto",KK:"Қала",IT:"Città",LV:"Pilsēta"},dict.street={EN:"Street",RU:"Улица",FR:"Rue",DE:"Straße",ES:"Calle",PT:"Rua",JA:"通り",ZH:"街道",UK:"Вулиця",PL:"Ulica",KK:"Көше",IT:"Strada",LV:"Iela"},dict.house={EN:"House",RU:"Дом",FR:"Loger",DE:"Haus",ES:"Edificio №",PT:"Lar",JA:"家",ZH:"屋",UK:"Будинок",PL:"Budynek",KK:"Үй",IT:"Casa",LV:"Māja"},dict.entrance={EN:"Entrance",RU:"Подъезд",FR:"Entrée",DE:"Eingang",ES:"Entrada",PT:"Entrada",JA:"エントランス",ZH:"入口",UK:"Під’їзд",PL:"Wejście",KK:"Кіру",IT:"Ingresso",LV:"Ieeja"},dict.floor={EN:"Floor",RU:"Этаж",FR:"Étage",DE:"Fußboden",ES:"Planta",PT:"Andar",JA:"床",ZH:"地面",UK:"Поверх",PL:"Piętro",KK:"Еден",IT:"Pavimento",LV:"Stāvs"},dict.apt={EN:"Apt/office",RU:"Квартира/офис",FR:"Apt/bureau",DE:"Apt/Büro",ES:"Piso/oficina",PT:"Apt/escritório",JA:"アプト/オフィス",ZH:"公寓/办公室",UK:"Квартира/офіс",PL:"Mieszkanie/lokal",KK:"Пәтер/кеңсе",IT:"Abitazione/ufficio",LV:"Dzīvoklis/birojs"},dict.phone={EN:"Phone",RU:"Телефон",FR:"Téléphoner",DE:"Telefon",ES:"Teléfono",PT:"Telefone",JA:"電話",ZH:"电话",UK:"Телефон",PL:"Telefon",KK:"Телефон",IT:"Telefono",LV:"Tālrunis"},dict.phones={EN:"Phones",RU:"Телефоны",FR:"Téléphones",DE:"Telefone",ES:"Telefonos",PT:"Telefones",JA:"電話",ZH:"手机",UK:"Телефони",PL:"Telefony",KK:"Телефондар",IT:"Cellulari",LV:"Telefoni"},dict.entranceCode={EN:"Entrance code",RU:"Домофон",FR:"Code d'entrée",DE:"Zugangscode",ES:"Código de entrada",PT:"Código de entrada",JA:"エントランスコード",ZH:"入口代码",UK:"Домофон",PL:"Domofon",KK:"Түсу коды",IT:"Codice d'ingresso",LV:"Ieejas kods"},dict.comment={EN:"Comment",RU:"Комментарий",FR:"Commenter",DE:"Kommentar",ES:"Comentario",PT:"Comente",JA:"コメント",ZH:"评论",UK:"Коментар",PL:"Komentarz",KK:"Түсініктеме",IT:"Commento",LV:"Komentāri"},dict.day={EN:"day",RU:"дня",FR:"journée",DE:"tag",ES:"día",PT:"dia",JA:"日",ZH:"日",UK:"дні",PL:"dzień",KK:"күн",IT:"giorno",LV:"diena"},dict.days={EN:"days",RU:"дней",FR:"journées",DE:"Tage",ES:"dias",PT:"dias",JA:"日々",ZH:"天",UK:"днів",PL:"dzień",KK:"күн",IT:"giorni",LV:"dienas"},dict.from={EN:"from",RU:"от",FR:"de",DE:"von",ES:"de",PT:"de",JA:"から",ZH:"从",UK:"від",PL:"od",KK:"бастап",IT:"da",LV:"no"},dict.deliveryNotPossible={EN:"Unfortunately, delivery to your chosen city is not possible",RU:"К сожалению, в выбранный вами город доставка не осуществляется",FR:"Malheureusement, la livraison à votre ville choisie n'est pas possible",DE:"Leider ist eine Lieferung in der gewählten Stadt nicht möglich",ES:"Por desgracia, la entrega a su ciudad elegida no es posible",PT:"Infelizmente, a entrega à sua cidade escolhida não é possível",JA:"残念ながら、あなたの選ばれた都市への配信を行うことはできません",ZH:"不幸的是，送货到你所选择的城市是不可能的",UK:"На жаль, в обране місто доставка не здійснюється",PL:"Niestety nie dostarczamy w wybrane przez ciebie miejsce",KK:"Өкінішке орай, Сіздің таңдаған қалаға жеткізу мүмкін емес",IT:"Purtroppo, la consegna al vostro città scelta non è possibile",LV:"Diemžēl piegāde uz jūsu izvēlēto pilsētu netiek veikta"},dict.delivery={EN:"Delivery",RU:"Доставка",FR:"Livraison",DE:"Lieferung",ES:"Entrega",PT:"Entrega",JA:"配達",ZH:"交货",UK:"Доставка",PL:"Dostawa",KK:"Жеткізілім",IT:"Consegna",LV:"Piegāde"},dict.pickup={EN:"Pickup location",RU:"Пункт получения",FR:"Lieu de ramassage",DE:"Treffpunkt",ES:"Lugar de recogida",PT:"Local de retirada",JA:"ピックアップ場所",ZH:"接人的地方",UK:"Пункт отримання",PL:"Miejsce odbioru",KK:"Жеткізу орны",IT:"Posto di raccolta",LV:"Saņemšanas punkts"},dict.selectPickup={EN:"Select pickup location",RU:"Выберите пункт получения",FR:"Sélectionnez l'emplacement pick-up",DE:"Wählen Sie Abholort",ES:"Seleccionar ubicación de recogida",PT:"Escolha local de retirada",JA:"ピックアップ場所を選択",ZH:"选择的取货地点",UK:"Виберіть пункт отримання",PL:"Wybierz miejsce odbioru",KK:"Желімді орынды таңдаңыз",IT:"Seleziona ubicazione pickup",LV:"Izvēlieties pikaps atrašanās vietu"},dict.selectAddress={EN:"Please select an address from the options provided",RU:"Пожалуйста, выберите адрес из предложенных вариантов",FR:"S'il vous plaît sélectionner une adresse parmi les options proposées",DE:"Bitte wählen Sie eine Adresse aus den Optionen zur Verfügung gestellt",ES:"Por favor, seleccione una dirección de una de las opciones proporcionadas",PT:"Por favor seleccione um endereço entre as opções fornecidas",JA:"提供されるオプションからアドレスを選択してください",ZH:"请从所提供的选项的地址",UK:"Будь ласка, виберіть адресу із запропонованих варіантів",PL:"Wybierz adres wśród oferowanych opcji",KK:"Берілген параметрлерден мекенжайды таңдаңыз",IT:"Si prega di selezionare un indirizzo tra le opzioni previste",LV:"Lūdzu, izvēlieties adresi no piedāvātajām iespējām"},dict.selectCity={EN:"Please select an city from the options provided",RU:"Пожалуйста, выберите город из предложенных вариантов",FR:"S'il vous plaît choisir une ville parmi les options proposées",DE:"Bitte wählen Sie eine Stadt aus den Optionen zur Verfügung gestellt",ES:"Por favor, seleccione una ciudad de entre las opciones proporcionadas",PT:"Por favor, selecione uma cidade entre as opções fornecidas",JA:"提供されるオプションから都市を選択してください",ZH:"请从所提供的选项的城市",UK:"Будь ласка, виберіть місто із запропонованих варіантів",PL:"Wybierz miejsce wśród oferowanych opcji",KK:"Берілген параметрлерден бір қаланы таңдаңыз",IT:"Si prega di selezionare una città tra le opzioni previste",LV:"Lūdzu, izvēlieties pilsētu no piedāvātajām iespējām"},dict.orderComment={EN:"Order comment",RU:"Комментарий к заказу",FR:"Commentaire de commande",DE:"Bestellen Kommentar",ES:"Comentario de la orden",PT:"Comentário ordem",JA:"注文のコメント",ZH:"为了评论",UK:"Коментар до замовлення",PL:"Komentarz do zamówienia",KK:"Тапсырыс беру қатынасқа",IT:"Commento Order",LV:"Komentējiet pasūtījumu"},dict.select={EN:"Select",RU:"Выбрать",FR:"Sélectionner",DE:"Wählen",ES:"Seleccione",PT:"Selecionar",JA:"選択する",ZH:"选择",UK:"Вибрати",PL:"Wybierz",KK:"Таңдаңыз",IT:"Selezionare",LV:"Izvēlieties"},dict.workingHours={EN:"Working hours",RU:"Время работы",FR:"Heures d'ouverture",DE:"Arbeitszeit",ES:"Horas Laborales",PT:"Jornada de trabalho",JA:"勤務時間",ZH:"工作时间",UK:"Час роботи",PL:"Godziny robocze",KK:"Жұмыс сағаттары",IT:"Ore lavorative",LV:"Darba stundas"},dict.unavailable={EN:"Delivery service temporarily unavailable.",RU:"К сожалению, в данный момент сервис доставки недоступен.",FR:"Service de livraison temporairement indisponible.",DE:"Zustelldienst vorübergehend nicht verfügbar.",ES:"Servicio de entrega disponible temporalmente.",PT:"Serviço de entrega temporariamente indisponíveis.",JA:"配達サービスが一時的に利用できません。",ZH:"送货服务暂时不可用。",UK:"Служба доставки тимчасово не працює.",PL:"Niestety, w tym momencie dostawa nie jest możliwa.",KK:"Жеткізу қызметі уақытша қол жетімсіз.",IT:"Servizio di consegna temporaneamente non disponibile.",LV:"Diemžēl piegādes pakalpojums pašlaik nav pieejams."},dict.loadingServices={EN:"Loading delivery services",RU:"Получение сервисов доставки",FR:"Services de livraison de chargement",DE:"Laden Zustelldienste",ES:"Servicios Carga de entrega",PT:"Serviços de carga de entrega",JA:"ローディング配信サービス",ZH:"加载送货服务",UK:"Отримання сервісів доставки",PL:"Otrzymanie serwisów dostawy",KK:"Жеткізу қызметтері жүктелуде",IT:"Servizi di consegna Caricamento",LV:"Piegādes pakalpojumu saņemšana"},dict.loadingPickup={EN:"Loading a list of pickup locations",RU:"Получение списка пунктов выдачи заказов",FR:"Chargement d'une liste d'emplacements pick-up",DE:"Laden einer Liste von Standorten pickup",ES:"Carga de una lista de los lugares de recogida",PT:"Carregando uma lista de locais de coleta",JA:"ピックアップ場所のリストを読み込みます",ZH:"加载接客位置的列表",UK:"Отримання списку пунктів видачі замовлень",PL:"Otrzymanie listy miejsc wydania zamówień",KK:"Желімді орындардың тізімін жүктеу",IT:"Caricamento di un elenco di luoghi di ritiro",LV:"Saņemšanas punktu saraksta iegūšana"},dict.noResult={EN:"No results were found for your request",RU:"По вашему запросу ничего не найдено",FR:"Aucun résultat n'a été trouvé pour votre demande",DE:"Es wurden keine Ergebnisse für Ihre Anfrage gefunden",ES:"No se encontraron resultados para su solicitud",PT:"Não foram encontrados resultados para sua solicitação",JA:"該当する結果はあなたの要求のために見つかりませんでした",ZH:"没有找到您的要求",UK:"За вашим запитом нічого не знайдено",PL:"Brak wyników",KK:"Нәтижелері Сіздің сұранысыңыз бойынша табылған жоқ",IT:"Non sono stati trovati risultati per la tua richiesta",LV:"Jūsu meklēšanas vaicājumam netika atrasts neviens rezultāts"},dict.change={EN:"Change",RU:"Изменить",FR:"Changer",DE:"Veränderung",ES:"Cambio",PT:"Mudar",JA:"変化する",ZH:"改变",UK:"Змінити",PL:"Zmień",KK:"Өзгеріс",IT:"Modificare",LV:"Rediģēt"},dict.fullName={EN:"Full name",RU:"Получатель (ФИО полностью)",FR:"Nom et prénom",DE:"Vollständiger Name",ES:"Nombre completo",PT:"Nome completo",JA:"フルネーム",ZH:"全名",UK:"Одержувач (ПІБ повністю)",PL:"Pełne imię",KK:"Толық аты",IT:"Nome e cognome",LV:"Saņēmējs (pilns vārds)"},dict.johnDoe={EN:"John Doe",RU:"Иванов Иван Иванович",FR:"Jean Dupont",DE:"Max Mustermann",ES:"Fulano de Tal",PT:"Fulano de Tal",JA:"なになに",ZH:"张三",UK:"Іван Іванович Іваненко",PL:"Jan Kowalski",KK:"Алмаз Ахметов",IT:"Mario Rossi",LV:"John Doe"};var lang=window.t_delivery__browserLang;return dict[msg]?dict[msg][lang]?dict[msg][lang]:dict[msg].EN:"Text not found #"+msg}function t_delivery__declensionOfNumber(number){return parseInt(number,10)%10==1&&11!==parseInt(number,10)?t_delivery__dict("day"):t_delivery__dict("days")}function t_delivery__showPrice(price){if(void 0===price||0==price||""==price)price="";else{var foo;if(price=price.toString(),void 0!==window.tcart.currency_dec&&"00"==window.tcart.currency_dec)if(-1===price.indexOf(".")&&-1===price.indexOf(","))price+=".00";else 1===price.substr(price.indexOf(".")+1).length&&(price+="0");price=price.replace(/\B(?=(\d{3})+(?!\d))/g," "),void 0!==window.tcart.currency_sep&&","==window.tcart.currency_sep&&(price=price.replace(".",",")),price=window.tcart.currency_txt_l+price+window.tcart.currency_txt_r}return price}function t_delivery__triggerEvent(el,eventName){var event;document.createEvent?(event=document.createEvent("HTMLEvents")).initEvent(eventName,!0,!1):document.createEventObject&&((event=document.createEventObject()).eventType=eventName),event.eventName=eventName,el.dispatchEvent?el.dispatchEvent(event):el.fireEvent?el.fireEvent("on"+event.eventType,event):el[eventName]?el[eventName]():el["on"+eventName]&&el["on"+eventName]()}